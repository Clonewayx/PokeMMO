!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),o=r(s),a=i(2),u=r(a),l=i(6),h=i(64),c=r(h),f=i(126),d=r(f),p=i(140),y=r(p),v=i(143),g=r(v),m=i(153),E=n(m),x=i(154),_=n(x),S=i(161),w=n(S),M=function(){function t(){(0,o["default"])(this,t),this.canvasNode=document.querySelector("#canvas"),this.glNode=document.querySelector("#webgl"),this.uiNode=document.querySelector("#ui"),this.entities=_,this.scenes=w,this.engine=new c["default"](this),this.setup()}return(0,u["default"])(t,[{key:"setup",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?void 0===e?0:e:arguments[0];switch(++e){case 1:return void this.addWorld(function(){return t.setup(e)});case 2:return void this.addMap(function(){return t.setup(e)});case 3:return void this.addEntities(function(){return t.setup(e)});case 4:return this.engine.renderer=new d["default"](this.engine),void this.setup(e);case 5:return this.animateNPC(),void this.setup(e);case 6:return this.engine.camera.focus(this.engine.getEntityByProperty("Felix","name"),!0),void this.setup(e);case 7:return window.rAF(function(){return t.engine.renderer.render()}),void this.setup(e);case 8:return this.input=new y["default"](E,this),void this.setup(e);case 9:return void(l.OFFLINE_MODE||(this.engine.connection=new g["default"](this,l.CONNECTION_URL+":"+l.CONNECTION_PORT)))}}},{key:"animateNPC",value:function(){setTimeout(function(){var t=this.engine.getEntityByProperty("Joy","name"),e=[l.LEFT,l.RIGHT,l.UP,l.DOWN][3*Math.random()<<0];t.move(e),this.animateNPC()}.bind(this),2e3)}},{key:"addWorld",value:function(t){this.engine.addWorld("worlds/kanto/index.js",t)}},{key:"addMap",value:function(t){this.engine.addMap("worlds/kanto/town/town.json",t)}},{key:"addEntities",value:function(t){var e=this.entities.Player;return this.engine.addEntity(new e({name:"Joy",map:"Town",x:104,y:176,sprite:"assets/img/200.png",width:16,height:16,collidable:!0,facing:2,onCollide:{JavaScript:function(t,e){this.faceEntity(t),e.instance.notify(this,"Stop!")}}})),this.engine.addEntity(new e({name:"Merlin",map:"Town",x:176,y:152,sprite:"assets/img/85.png",width:16,height:16,collidable:!0,shadowY:-3,onAction:{EngelScript:"\n          if (trigger.facing == 2 || trigger.facing == 3) {\n            FLAGS.COUNTER += 1;\n          } {\n            FLAGS.COUNTER -= 1;\n          }\n          kernel.notify(this, '+' + FLAGS.COUNTER + \" \");\n          this.faceEntity(trigger);\n        "}})),this.engine.addEntity(new e({name:"Merlin2",map:"Town",x:168,y:168,sprite:"assets/img/85.png",width:16,height:16,collidable:!0,shadowY:-3,onCollide:{EngelScript:"\n          kernel.notify(this, trigger.name);\n        "}})),this.engine.addEntity(new e({name:"Mew",map:"Town",sprite:"assets/img/151.png",width:16,height:16,collidable:!1,following:"Joy"})),this.engine.addEntity(new e({name:"Charizard",map:"Town",sprite:"assets/img/4.png",width:16,height:16,collidable:!1,following:"Felix",onAction:{EngelScript:'\n          kernel.notify(this, ":p");\n          trigger.leader.faceEntity(trigger);\n        '}})),this.engine.addEntity(new e({name:"Flareon",map:"Town",sprite:"assets/img/136.png",width:16,height:16,collidable:!1,following:"Mew"})),l.OFFLINE_MODE&&this.engine.addEntity(new e({name:"Felix",map:"Town",x:152,y:128,sprite:"assets/img/0.png",width:16,height:16,isLocalPlayer:!0,collidable:!0,onJump:function(t,e){t.leader&&(setTimeout(function(){return e.instance.notify(t.leader," :3 ")},250),setTimeout(function(){return t.leader.jump()},500))}})),t()}}]),t}();e["default"]=M,window.game=new M},function(t,e){"use strict";e.__esModule=!0,e["default"]=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}e.__esModule=!0;var r=i(3),s=n(r);e["default"]=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,s["default"])(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}()},function(t,e,i){t.exports={"default":i(4),__esModule:!0}},function(t,e,i){var n=i(5);t.exports=function(t,e,i){return n.setDesc(t,e,i)}},function(t){var e=Object;t.exports={create:e.create,getProto:e.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:e.getOwnPropertyDescriptor,setDesc:e.defineProperty,setDescs:e.defineProperties,getKeys:e.keys,getNames:e.getOwnPropertyNames,getSymbols:e.getOwnPropertySymbols,each:[].forEach}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ColorPalette=e.TYPES=e.VOLUME=e.BGS=e.BGM=e.GRAVITY=e.DOWN=e.RIGHT=e.UP=e.LEFT=e.SHADOW_ALPHA=e.SHADOW_Y=e.SHADOW_X=e.DISPLAY_SHADOWS=e.MAX_SCALE=e.MIN_SCALE=e.PIXEL_SCALE=e.DIMENSION=e.Y_DEPTH_HACK=e.DEBUG_FPS=e.MINI_MAP=e.GOD_MODE=e.EDIT_MODE=e.RECORD_MODE=e.OFFLINE_MODE=e.DEBUG_MODE=e.EASING_CAMERA=e.FREE_CAMERA=e.WALK_BY_KEYBOARD=e.WGL_SUPPORT=e.VERSION=e.__dirname=e.CONNECTION_PORT=e.CONNECTION_URL=e.GRID_WIDTH=e.RENDER_MODE=e.WGL=e.CANVAS=e.IS_CLIENT=void 0;var n=i(7);e.IS_CLIENT=!0,e.CANVAS=0,e.WGL=1,e.RENDER_MODE=-1,e.GRID_WIDTH=1,e.CONNECTION_URL=(0,n.getLocalHost)(),e.CONNECTION_PORT=449,e.__dirname="./src/",e.VERSION="0.1.0",e.WGL_SUPPORT=!1,e.WALK_BY_KEYBOARD=!0,e.FREE_CAMERA=!1,e.EASING_CAMERA=!1,e.DEBUG_MODE=!0,e.OFFLINE_MODE=!0,e.RECORD_MODE=!0,e.EDIT_MODE=!0,e.GOD_MODE=!1,e.MINI_MAP=!0,e.DEBUG_FPS=60,e.Y_DEPTH_HACK=1e-4,e.DIMENSION=8,e.PIXEL_SCALE=.125,e.MIN_SCALE=3,e.MAX_SCALE=12.5,e.DISPLAY_SHADOWS=!0,e.SHADOW_X=1,e.SHADOW_Y=1.45,e.SHADOW_ALPHA=.85,e.LEFT=3,e.UP=1,e.RIGHT=2,e.DOWN=0,e.GRAVITY=-1,e.BGM=!0,e.BGS=!0,e.VOLUME={LOCAL_PLAYER:100,NETWORK_PLAYER:10,MUSIC:30,ENTITY_NOISE:30,FADE_SPEED:2500},e.TYPES={Notification:0,MapEntity:1,Player:2,Ping:3},e.ColorPalette=[[135,100,100],[135,105,100],[140,110,100],[150,115,100],[155,125,100],[150,135,100],[135,135,100],[135,125,100],[130,125,100],[130,120,100],[135,120,100],[145,130,100],[150,145,100],[135,145,100],[145,150,100],[150,125,100],[145,130,100],[135,130,100],[125,135,100],[135,130,100],[135,135,100],[135,100,100],[135,105,100],[140,110,100],[150,115,100]]},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(){var t=null;try{if(t=document.createElement("canvas"),void 0!==WebGLRenderingContext)return!!o(t)}catch(e){return!1}return!1}function s(){return"undefined"!=typeof document?document.location.host.replace(/:.*/,""):void 0}function o(t){var e={alpha:!0,antialias:!1,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1};return t.getContext("webgl",e)||t.getContext("experimental-webgl",e)}function a(t,e,i,n){return S[t]?void n(S[t]):void new x["default"](t,e,i,function(e){n(S[t]=e)})}function u(){var t=++w;return M.indexOf(t)>-1?this.uHash():(M.push(t),t)}function l(t){return t.replace(_.path.exec(t)[0],"")}function h(t,e){var i=null;for(i in e)e[i]instanceof Function&&(t.prototype[i]=e[i])}function c(t,e){var i=document.createElement("canvas"),n=i.getContext("2d");return n.setImageSmoothing(!1),i.width=t,i.height=e,n}function f(t){var e=c(t.width,t.height);return e.drawImage(t,0,0,t.width,t.height),e}function d(t){var e=new Image;return e.src=t.toDataURL("image/png"),e}function p(t,e,i,n,r){var s=0,o=0,a=t.getImageData(2*e,2*i,2*n,2*r).data;for(o=a.length;o>s;s+=4){if(a[s]>0)return!0;if(a[s+1]>0)return!0;if(a[s+2]>0)return!0;if(a[s+3]>0)return!0}return!1}function y(){var t=new Date;return{hours:t.getHours(),minutes:t.getMinutes(),seconds:t.getSeconds()}}function v(t){return new m["default"](function(e,i){var n=new XMLHttpRequest;n.open("GET",t),n.onload=function(){200===n.status?e(n.response):i(new Error(n.statusText))},n.onerror=function(){i(new Error("Network error"))},n.send()})}Object.defineProperty(e,"__esModule",{value:!0}),e.Maps=e.TextureCache=void 0,e.supportWGL=r,e.getLocalHost=s,e.getWGLContext=o,e.getSprite=a,e.uHash=u,e.getPath=l,e.inherit=h,e.createCanvasBuffer=c,e.imageToCanvas=f,e.canvasToImage=d,e.tileContainsImageData=p,e.getTime=y,e.ajax=v;var g=i(8),m=n(g),E=i(62),x=n(E),_={path:/[^\\/]+$/},S=e.TextureCache={},w=-1,M=[];e.Maps={}},function(t,e,i){t.exports={"default":i(9),__esModule:!0}},function(t,e,i){i(10),i(11),i(34),i(41),t.exports=i(19).Promise},function(){},function(t,e,i){"use strict";var n=i(12)(!0);i(15)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=n(e,i),this._i+=t.length,{value:t,done:!1})})},function(t,e,i){var n=i(13),r=i(14);t.exports=function(t){return function(e,i){var s,o,a=String(r(e)),u=n(i),l=a.length;return 0>u||u>=l?t?"":void 0:(s=a.charCodeAt(u),55296>s||s>56319||u+1===l||(o=a.charCodeAt(u+1))<56320||o>57343?t?a.charAt(u):s:t?a.slice(u,u+2):(s-55296<<10)+(o-56320)+65536)}}},function(t){var e=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:e)(t)}},function(t){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,i){"use strict";var n=i(16),r=i(17),s=i(22),o=i(23),a=i(27),u=i(28),l=i(29),h=i(30),c=i(5).getProto,f=i(31)("iterator"),d=!([].keys&&"next"in[].keys()),p="@@iterator",y="keys",v="values",g=function(){return this};t.exports=function(t,e,i,m,E,x,_){l(i,e,m);var S,w,M=function(t){if(!d&&t in I)return I[t];switch(t){case y:return function(){return new i(this,t)};case v:return function(){return new i(this,t)}}return function(){return new i(this,t)}},b=e+" Iterator",T=E==v,O=!1,I=t.prototype,N=I[f]||I[p]||E&&I[E],P=N||M(E);if(N){var A=c(P.call(new t));h(A,b,!0),!n&&a(I,p)&&o(A,f,g),T&&N.name!==v&&(O=!0,P=function(){return N.call(this)})}if(n&&!_||!d&&!O&&I[f]||o(I,f,P),u[e]=P,u[b]=g,E)if(S={values:T?P:M(v),keys:x?P:M(y),entries:T?M("entries"):P},_)for(w in S)w in I||s(I,w,S[w]);else r(r.P+r.F*(d||O),e,S);return S}},function(t){t.exports=!0},function(t,e,i){var n=i(18),r=i(19),s=i(20),o="prototype",a=function(t,e,i){var u,l,h,c=t&a.F,f=t&a.G,d=t&a.S,p=t&a.P,y=t&a.B,v=t&a.W,g=f?r:r[e]||(r[e]={}),m=f?n:d?n[e]:(n[e]||{})[o];f&&(i=e);for(u in i)l=!c&&m&&u in m,l&&u in g||(h=l?m[u]:i[u],g[u]=f&&"function"!=typeof m[u]?i[u]:y&&l?s(h,n):v&&m[u]==h?function(t){var e=function(e){return this instanceof t?new t(e):t(e)};return e[o]=t[o],e}(h):p&&"function"==typeof h?s(Function.call,h):h,p&&((g[o]||(g[o]={}))[u]=h))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,t.exports=a},function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(t){var e=t.exports={version:"1.2.6"};"number"==typeof __e&&(__e=e)},function(t,e,i){var n=i(21);t.exports=function(t,e,i){if(n(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)}}return function(){return t.apply(e,arguments)}}},function(t){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,i){t.exports=i(23)},function(t,e,i){var n=i(5),r=i(24);t.exports=i(25)?function(t,e,i){return n.setDesc(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,i){t.exports=!i(26)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t){t.exports=function(t){try{return!!t()}catch(e){return!0}}},function(t){var e={}.hasOwnProperty;t.exports=function(t,i){return e.call(t,i)}},function(t){t.exports={}},function(t,e,i){"use strict";var n=i(5),r=i(24),s=i(30),o={};i(23)(o,i(31)("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=n.create(o,{next:r(1,i)}),s(t,e+" Iterator")}},function(t,e,i){var n=i(5).setDesc,r=i(27),s=i(31)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,s)&&n(t,s,{configurable:!0,value:e})}},function(t,e,i){var n=i(32)("wks"),r=i(33),s=i(18).Symbol;t.exports=function(t){return n[t]||(n[t]=s&&s[t]||(s||r)("Symbol."+t))}},function(t,e,i){var n=i(18),r="__core-js_shared__",s=n[r]||(n[r]={});t.exports=function(t){return s[t]||(s[t]={})}},function(t){var e=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+i).toString(36))}},function(t,e,i){i(35);var n=i(28);n.NodeList=n.HTMLCollection=n.Array},function(t,e,i){"use strict";var n=i(36),r=i(37),s=i(28),o=i(38);t.exports=i(15)(Array,"Array",function(t,e){this._t=o(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,r(1)):"keys"==e?r(0,i):"values"==e?r(0,t[i]):r(0,[i,t[i]])},"values"),s.Arguments=s.Array,n("keys"),n("values"),n("entries")},function(t){t.exports=function(){}},function(t){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){var n=i(39),r=i(14);t.exports=function(t){return n(r(t))}},function(t,e,i){var n=i(40);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},function(t,e,i){"use strict";var n,r=i(5),s=i(16),o=i(18),a=i(20),u=i(42),l=i(17),h=i(43),c=i(44),f=i(21),d=i(45),p=i(46),y=i(51).set,v=i(52),g=i(31)("species"),m=i(53),E=i(54),x="Promise",_=o.process,S="process"==u(_),w=o[x],M=function(t){var e=new w(function(){});return t&&(e.constructor=Object),w.resolve(e)===e},b=function(){function t(e){var i=new w(e);return y(i,t.prototype),i}var e=!1;try{if(e=w&&w.resolve&&M(),y(t,w),t.prototype=r.create(w.prototype,{constructor:{value:t}}),t.resolve(5).then(function(){})instanceof t||(e=!1),e&&i(25)){var n=!1;w.resolve(r.setDesc({},"then",{get:function(){n=!0}})),e=n}}catch(s){e=!1}return e}(),T=function(t,e){return s&&t===w&&e===n?!0:v(t,e)},O=function(t){var e=c(t)[g];return void 0!=e?e:t},I=function(t){var e;return h(t)&&"function"==typeof(e=t.then)?e:!1},N=function(t){var e,i;this.promise=new t(function(t,n){if(void 0!==e||void 0!==i)throw TypeError("Bad Promise constructor");e=t,i=n}),this.resolve=f(e),this.reject=f(i)},P=function(t){try{t()}catch(e){return{error:e}}},A=function(t,e){if(!t.n){t.n=!0;var i=t.c;E(function(){for(var n=t.v,r=1==t.s,s=0,a=function(e){var i,s,o=r?e.ok:e.fail,a=e.resolve,u=e.reject;try{o?(r||(t.h=!0),i=o===!0?n:o(n),i===e.promise?u(TypeError("Promise-chain cycle")):(s=I(i))?s.call(i,a,u):a(i)):u(n)}catch(l){u(l)}};i.length>s;)a(i[s++]);i.length=0,t.n=!1,e&&setTimeout(function(){var e,i,r=t.p;D(r)&&(S?_.emit("unhandledRejection",n,r):(e=o.onunhandledrejection)?e({promise:r,reason:n}):(i=o.console)&&i.error&&i.error("Unhandled promise rejection",n)),t.a=void 0},1)})}},D=function(t){var e,i=t._d,n=i.a||i.c,r=0;if(i.h)return!1;for(;n.length>r;)if(e=n[r++],e.fail||!D(e.promise))return!1;return!0},k=function(t){var e=this;e.d||(e.d=!0,e=e.r||e,e.v=t,e.s=2,e.a=e.c.slice(),A(e,!0))},C=function(t){var e,i=this;if(!i.d){i.d=!0,i=i.r||i;try{if(i.p===t)throw TypeError("Promise can't be resolved itself");(e=I(t))?E(function(){var n={r:i,d:!1};try{e.call(t,a(C,n,1),a(k,n,1))}catch(r){k.call(n,r)}}):(i.v=t,i.s=1,A(i,!1))}catch(n){k.call({r:i,d:!1},n)}}};b||(w=function(t){f(t);var e=this._d={p:d(this,w,x),c:[],a:void 0,s:0,d:!1,v:void 0,h:!1,n:!1};try{t(a(C,e,1),a(k,e,1))}catch(i){k.call(e,i)}},i(59)(w.prototype,{then:function(t,e){var i=new N(m(this,w)),n=i.promise,r=this._d;return i.ok="function"==typeof t?t:!0,i.fail="function"==typeof e&&e,r.c.push(i),r.a&&r.a.push(i),r.s&&A(r,!1),n},"catch":function(t){return this.then(void 0,t)}})),l(l.G+l.W+l.F*!b,{Promise:w}),i(30)(w,x),i(60)(x),n=i(19)[x],l(l.S+l.F*!b,x,{reject:function(t){var e=new N(this),i=e.reject;return i(t),e.promise}}),l(l.S+l.F*(!b||M(!0)),x,{resolve:function(t){if(t instanceof w&&T(t.constructor,this))return t;var e=new N(this),i=e.resolve;return i(t),e.promise}}),l(l.S+l.F*!(b&&i(61)(function(t){w.all(t)["catch"](function(){})})),x,{all:function(t){var e=O(this),i=new N(e),n=i.resolve,s=i.reject,o=[],a=P(function(){p(t,!1,o.push,o);var i=o.length,a=Array(i);i?r.each.call(o,function(t,r){var o=!1;e.resolve(t).then(function(t){o||(o=!0,a[r]=t,--i||n(a))},s)}):n(a)});return a&&s(a.error),i.promise},race:function(t){var e=O(this),i=new N(e),n=i.reject,r=P(function(){p(t,!1,function(t){e.resolve(t).then(i.resolve,n)})});return r&&n(r.error),i.promise}})},function(t,e,i){var n=i(40),r=i(31)("toStringTag"),s="Arguments"==n(function(){return arguments}());t.exports=function(t){var e,i,o;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=(e=Object(t))[r])?i:s?n(e):"Object"==(o=n(e))&&"function"==typeof e.callee?"Arguments":o}},function(t){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){var n=i(43);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t){t.exports=function(t,e,i){if(!(t instanceof e))throw TypeError(i+": use the 'new' operator!");return t}},function(t,e,i){var n=i(20),r=i(47),s=i(48),o=i(44),a=i(49),u=i(50);t.exports=function(t,e,i,l){var h,c,f,d=u(t),p=n(i,l,e?2:1),y=0;if("function"!=typeof d)throw TypeError(t+" is not iterable!");if(s(d))for(h=a(t.length);h>y;y++)e?p(o(c=t[y])[0],c[1]):p(t[y]);else for(f=d.call(t);!(c=f.next()).done;)r(f,p,c.value,e)}},function(t,e,i){var n=i(44);t.exports=function(t,e,i,r){try{return r?e(n(i)[0],i[1]):e(i)}catch(s){var o=t["return"];throw void 0!==o&&n(o.call(t)),s}}},function(t,e,i){var n=i(28),r=i(31)("iterator"),s=Array.prototype;t.exports=function(t){return void 0!==t&&(n.Array===t||s[r]===t)}},function(t,e,i){var n=i(13),r=Math.min;t.exports=function(t){return t>0?r(n(t),9007199254740991):0}},function(t,e,i){var n=i(42),r=i(31)("iterator"),s=i(28);t.exports=i(19).getIteratorMethod=function(t){return void 0!=t?t[r]||t["@@iterator"]||s[n(t)]:void 0}},function(t,e,i){var n=i(5).getDesc,r=i(43),s=i(44),o=function(t,e){if(s(t),!r(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,r){try{r=i(20)(Function.call,n(Object.prototype,"__proto__").set,2),r(t,[]),e=!(t instanceof Array)}catch(s){e=!0}return function(t,i){return o(t,i),e?t.__proto__=i:r(t,i),t}}({},!1):void 0),check:o}},function(t){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},function(t,e,i){var n=i(44),r=i(21),s=i(31)("species");t.exports=function(t,e){var i,o=n(t).constructor;return void 0===o||void 0==(i=n(o)[s])?e:r(i)}},function(t,e,i){var n,r,s,o=i(18),a=i(55).set,u=o.MutationObserver||o.WebKitMutationObserver,l=o.process,h=o.Promise,c="process"==i(40)(l),f=function(){var t,e,i;for(c&&(t=l.domain)&&(l.domain=null,t.exit());n;)e=n.domain,i=n.fn,e&&e.enter(),i(),e&&e.exit(),n=n.next;r=void 0,t&&t.enter()};if(c)s=function(){l.nextTick(f)};else if(u){var d=1,p=document.createTextNode("");new u(f).observe(p,{characterData:!0}),s=function(){p.data=d=-d}}else s=h&&h.resolve?function(){h.resolve().then(f)}:function(){a.call(o,f)};t.exports=function(t){var e={fn:t,next:void 0,domain:c&&l.domain};r&&(r.next=e),n||(n=e,s()),r=e}},function(t,e,i){var n,r,s,o=i(20),a=i(56),u=i(57),l=i(58),h=i(18),c=h.process,f=h.setImmediate,d=h.clearImmediate,p=h.MessageChannel,y=0,v={},g="onreadystatechange",m=function(){var t=+this;if(v.hasOwnProperty(t)){var e=v[t];delete v[t],e()}},E=function(t){m.call(t.data)};f&&d||(f=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return v[++y]=function(){a("function"==typeof t?t:Function(t),e)},n(y),y},d=function(t){delete v[t]},"process"==i(40)(c)?n=function(t){c.nextTick(o(m,t,1))}:p?(r=new p,s=r.port2,r.port1.onmessage=E,n=o(s.postMessage,s,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts?(n=function(t){h.postMessage(t+"","*")},h.addEventListener("message",E,!1)):n=g in l("script")?function(t){u.appendChild(l("script"))[g]=function(){u.removeChild(this),m.call(t)}}:function(t){setTimeout(o(m,t,1),0)}),t.exports={set:f,clear:d}},function(t){t.exports=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},function(t,e,i){t.exports=i(18).document&&document.documentElement},function(t,e,i){var n=i(43),r=i(18).document,s=n(r)&&n(r.createElement);t.exports=function(t){return s?r.createElement(t):{}}},function(t,e,i){var n=i(22);t.exports=function(t,e){for(var i in e)n(t,i,e[i]);return t}},function(t,e,i){"use strict";var n=i(19),r=i(5),s=i(25),o=i(31)("species");t.exports=function(t){var e=n[t];s&&e&&!e[o]&&r.setDesc(e,o,{configurable:!0,get:function(){return this}})}},function(t,e,i){var n=i(31)("iterator"),r=!1;try{var s=[7][n]();s["return"]=function(){r=!0},Array.from(s,function(){throw 2})}catch(o){}t.exports=function(t,e){if(!e&&!r)return!1;var i=!1;try{var s=[7],o=s[n]();o.next=function(){i=!0},s[n]=function(){return o},t(s)}catch(a){}return i}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),o=r(s),a=i(2),u=r(a),l=i(7),h=i(6),c=i(63),f=n(c),d=function(){function t(e,i,n,r){(0,o["default"])(this,t),this.texture=null,this.texture_effect=null,this.effect_sprites=[],this.sprites=[],this.imgUrl=e,this.width=0,this.height=0,this.sWidth=i,this.sHeight=n,this.xMul=0,this.yMul=0,this.hasLoaded=!1,this.fromImage(this.imgUrl,function(){r(this)}.bind(this))}return(0,u["default"])(t,[{key:"fromImage",value:function(e,i){var n=null,r=l.TextureCache[e];return void 0!==r&&r instanceof t?(this.hasLoaded=!0,l.TextureCache[e]):(n=new Image,n.addEventListener("load",function(){this.width=n.width,this.height=n.height,this.hasLoaded=!0,this.texture=(0,l.imageToCanvas)(n),this.splitTexture(),l.TextureCache[e]=this,this.renderEffects(),i()}.bind(this)),void(n.src=e))}},{key:"splitTexture",value:function(){-1===this.sWidth&&-1===this.sHeight&&(this.sWidth=this.width/2,this.sHeight=this.height/2),this.xMul=this.height/(2*this.sWidth),this.yMul=this.width/(2*this.sHeight);for(var t=null,e=0,i=0,n=this.width/(2*this.sWidth),r=this.height/(2*this.sHeight);r>i;)for(e=0;n>e;++e)0===e&&++i,t=(0,l.createCanvasBuffer)(2*this.sWidth,2*this.sHeight),t.drawImage(this.texture.canvas,2*this.sWidth*e,2*this.sHeight*(i-1),this.width,this.height,0,0,this.width,this.height),this.sprites.push(t),t=null}},{key:"renderEffects",value:function(){this.buildTimeLightning()}},{key:"buildTimeLightning",value:function(){var t=0,e=0,i=null,n=0,r=0;for(e=this.sprites.length;e>t;++t)n=this.sprites[t].canvas.width,r=this.sprites[t].canvas.height,i=(0,l.createCanvasBuffer)(n,r),i.translate(0,r),i.scale(1,-1),this.drawTimeLightning(this.sprites[t],i,0,0,n,r,h.ColorPalette),i.setTransform(1,0,0,1,0,0),this.effect_sprites[t]=i,i=null}}]),t}();e["default"]=d,(0,l.inherit)(d,f)},function(t,e,i){"use strict";function n(t,e,i,n,r,o,a){var u=(0,s.getTime)().hours,l=t.getImageData(i,n,r,o);this.colorizePixels(l,a[u][0]/100,a[u][1]/100,a[u][2]/100,!1),e.putImageData(l,i,n)}function r(t,e,i,n,r){var s=0,o=0,a=t.data;if(o=a.length,r)for(;o/4>s;++s)a[4*s]>0&&(a[4*s]=i),a[4*s+1]>0&&(a[4*s+1]=e),a[4*s+2]>0&&(a[4*s+2]=i),a[4*s+3]>2&&(a[4*s+3]=n);else for(;o/4>s;++s)a[4*s+1]=a[4*s+1]/e,a[4*s+2]=a[4*s+2]/i,a[4*s+3]=a[4*s+3]*n}Object.defineProperty(e,"__esModule",{value:!0}),e.drawTimeLightning=n,e.colorizePixels=r;var s=i(7)},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(65),o=r(s),a=i(1),u=r(a),l=i(2),h=r(l),c=i(70),f=r(c),d=i(79),p=r(d),y=i(6),v=i(85),g=r(v),m=i(7),E=(i(88),i(89)),x=n(E),_=i(103),S=n(_),w=i(104),M=n(w),b=i(105),T=n(b),O=i(91),I=r(O),N=i(106),P=r(N),A=i(107),D=r(A),k=i(111),C=r(k),L=i(112),R=r(L),B=i(114),F=r(B),j=i(125),G=r(j),U=i(98),z=r(U),K=function(t){function e(t,i,n){(0,u["default"])(this,e);var r=(0,f["default"])(this,(0,o["default"])(e).call(this,null));return r.instance=t,r.currentMap=null,r.activeScene=!1,r.scenes={},r.node=r.instance.canvasNode,r.glNode=r.instance.glNode,r.uiNode=r.instance.uiNode,r.context=r.node.getContext("2d"),r.glContext=null,y.WGL_SUPPORT&&r.glNode&&(r.glContext=(0,m.getWGLContext)(r.glNode)),r.width=i||0,r.height=n||0,r.camera=new P["default"](r),r.maps={},r.localEntity=null,r.renderer=null,r.editor=new D["default"](r),r.mini=new C["default"](r),r.environment=new F["default"](r),r.connection=null,r.controller=new R["default"](r),r.init(),r}return(0,p["default"])(e,t),(0,h["default"])(e,[{key:"init",value:function(){this.initScenes(),this.camera.scale=y.MIN_SCALE}},{key:"initScenes",value:function(){for(var t in this.instance.scenes)this.scenes[t]=new this.instance.scenes[t](this)}},{key:"resizeScenes",value:function(){for(var t in this.scenes)this.scenes[t].active===!0&&(this.scenes[t].updatePositions(),this.scenes[t].render(),this.scenes[t].draw())}},{key:"addWorld",value:function(t,e){(0,m.ajax)(t).then(function(t){var i=new Function(t)();return console.log(i),e instanceof Function?e():void 0}.bind(this))}},{key:"sort",value:function(){this.depthSort(this.currentMap.entities)}},{key:"depthSort",value:function(t){for(var e=0,i=0,n=null,r=t.length;r>e;++e){for(i=e,n=t[i];i>0&&(t[i-1].position.y+-(2*t[i-1].z)+t[i-1].yMargin+t[i-1].size.y*t[i-1].scale)*t[i-1].zIndex>(n.position.y+-(2*n.z)+n.yMargin+n.size.y*n.scale)*n.zIndex;--i)t[i]=t[i-1];t[i]=n}}},{key:"ping",value:function(t,e){var i=this.camera.getGameMouseOffset(t,e),n=this.currentMap,r=n.objectTemplates.ping;r.x=i.x,r.y=i.y,r.z=0;var s=n.addEntity(r);s.opacity=0,s.fadeIn(2),s.lifeTime=this.renderer.now+60,s.type=y.TYPES.Ping,n.entities.push(s)}},{key:"notify",value:function(t,e,i){var n=this.currentMap,r=null!==this.localEntity&&t.id!==this.localEntity.id,s=new G["default"](this,{sprite:null,hasShadow:!1,width:g["default"].roundTo(this.context.measureText(String(e)).width,y.DIMENSION),height:16,msg:e,follow:t,style:i||"ChatBubble",fade:r||t instanceof I["default"],sound:r,absolute:t instanceof I["default"]});n.entities.push(s)}},{key:"walkByMouse",value:function(t,e){var i=this.localEntity;if(null!==i){var n=this.camera.getGameMouseOffset(t,e);i.walkTo(n.x,n.y)}}},{key:"width",set:function(t){this.width=t||0,this.camera.width=this.width}},{key:"height",set:function(t){this.height=t||0,this.camera.height=this.height}}]),e}(z["default"]);e["default"]=K,(0,m.inherit)(K,x),(0,m.inherit)(K,M),(0,m.inherit)(K,S),(0,m.inherit)(K,T)},function(t,e,i){t.exports={"default":i(66),__esModule:!0}},function(t,e,i){i(67),t.exports=i(19).Object.getPrototypeOf},function(t,e,i){var n=i(68);i(69)("getPrototypeOf",function(t){return function(e){return t(n(e))}})},function(t,e,i){var n=i(14);t.exports=function(t){return Object(n(t))}},function(t,e,i){var n=i(17),r=i(19),s=i(26);t.exports=function(t,e){var i=(r.Object||{})[t]||Object[t],o={};o[t]=e(i),n(n.S+n.F*s(function(){i(1)}),"Object",o)}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}e.__esModule=!0;var r=i(71),s=n(r);e["default"]=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==("undefined"==typeof e?"undefined":(0,s["default"])(e))&&"function"!=typeof e?t:e}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t){return t&&"undefined"!=typeof _Symbol&&t.constructor===_Symbol?"symbol":typeof t}e.__esModule=!0;var s=i(72),o=n(s);e["default"]=function(t){return t&&"undefined"!=typeof o["default"]&&t.constructor===o["default"]?"symbol":"undefined"==typeof t?"undefined":r(t)}},function(t,e,i){t.exports={"default":i(73),__esModule:!0}},function(t,e,i){i(74),i(10),t.exports=i(19).Symbol},function(t,e,i){"use strict";var n=i(5),r=i(18),s=i(27),o=i(25),a=i(17),u=i(22),l=i(26),h=i(32),c=i(30),f=i(33),d=i(31),p=i(75),y=i(76),v=i(77),g=i(78),m=i(44),E=i(38),x=i(24),_=n.getDesc,S=n.setDesc,w=n.create,M=y.get,b=r.Symbol,T=r.JSON,O=T&&T.stringify,I=!1,N=d("_hidden"),P=n.isEnum,A=h("symbol-registry"),D=h("symbols"),k="function"==typeof b,C=Object.prototype,L=o&&l(function(){return 7!=w(S({},"a",{get:function(){return S(this,"a",{value:7}).a}})).a})?function(t,e,i){var n=_(C,e);n&&delete C[e],S(t,e,i),n&&t!==C&&S(C,e,n)}:S,R=function(t){var e=D[t]=w(b.prototype);return e._k=t,o&&I&&L(C,t,{configurable:!0,set:function(e){s(this,N)&&s(this[N],t)&&(this[N][t]=!1),L(this,t,x(1,e))}}),e},B=function(t){return"symbol"==typeof t},F=function(t,e,i){return i&&s(D,e)?(i.enumerable?(s(t,N)&&t[N][e]&&(t[N][e]=!1),i=w(i,{enumerable:x(0,!1)})):(s(t,N)||S(t,N,x(1,{})),t[N][e]=!0),L(t,e,i)):S(t,e,i)},j=function(t,e){m(t);for(var i,n=v(e=E(e)),r=0,s=n.length;s>r;)F(t,i=n[r++],e[i]);return t},G=function(t,e){return void 0===e?w(t):j(w(t),e)},U=function(t){var e=P.call(this,t);return e||!s(this,t)||!s(D,t)||s(this,N)&&this[N][t]?e:!0},z=function(t,e){var i=_(t=E(t),e);return!i||!s(D,e)||s(t,N)&&t[N][e]||(i.enumerable=!0),i},K=function(t){for(var e,i=M(E(t)),n=[],r=0;i.length>r;)s(D,e=i[r++])||e==N||n.push(e);return n},Y=function(t){for(var e,i=M(E(t)),n=[],r=0;i.length>r;)s(D,e=i[r++])&&n.push(D[e]);return n},W=function(t){if(void 0!==t&&!B(t)){for(var e,i,n=[t],r=1,s=arguments;s.length>r;)n.push(s[r++]);return e=n[1],"function"==typeof e&&(i=e),!i&&g(e)||(e=function(t,e){return i&&(e=i.call(this,t,e)),B(e)?void 0:e}),n[1]=e,O.apply(T,n)}},H=l(function(){var t=b();return"[null]"!=O([t])||"{}"!=O({a:t})||"{}"!=O(Object(t))});k||(b=function(){if(B(this))throw TypeError("Symbol is not a constructor");return R(f(arguments.length>0?arguments[0]:void 0))},u(b.prototype,"toString",function(){return this._k}),B=function(t){return t instanceof b},n.create=G,n.isEnum=U,n.getDesc=z,n.setDesc=F,n.setDescs=j,n.getNames=y.get=K,n.getSymbols=Y,o&&!i(16)&&u(C,"propertyIsEnumerable",U,!0));var V={"for":function(t){return s(A,t+="")?A[t]:A[t]=b(t)},keyFor:function(t){return p(A,t)},useSetter:function(){I=!0},useSimple:function(){I=!1}};n.each.call("hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),function(t){var e=d(t);V[t]=k?e:R(e)}),I=!0,a(a.G+a.W,{Symbol:b}),a(a.S,"Symbol",V),a(a.S+a.F*!k,"Object",{create:G,defineProperty:F,defineProperties:j,getOwnPropertyDescriptor:z,getOwnPropertyNames:K,getOwnPropertySymbols:Y}),T&&a(a.S+a.F*(!k||H),"JSON",{stringify:W}),c(b,"Symbol"),c(Math,"Math",!0),c(r.JSON,"JSON",!0)},function(t,e,i){var n=i(5),r=i(38);t.exports=function(t,e){for(var i,s=r(t),o=n.getKeys(s),a=o.length,u=0;a>u;)if(s[i=o[u++]]===e)return i}},function(t,e,i){var n=i(38),r=i(5).getNames,s={}.toString,o="object"==typeof window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(t){try{return r(t)}catch(e){return o.slice()}};t.exports.get=function(t){return o&&"[object Window]"==s.call(t)?a(t):r(n(t))}},function(t,e,i){var n=i(5);t.exports=function(t){var e=n.getKeys(t),i=n.getSymbols;if(i)for(var r,s=i(t),o=n.isEnum,a=0;s.length>a;)o.call(t,r=s[a++])&&e.push(r);return e}},function(t,e,i){var n=i(40);t.exports=Array.isArray||function(t){return"Array"==n(t);
}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}e.__esModule=!0;var r=i(80),s=n(r),o=i(83),a=n(o),u=i(71),l=n(u);e["default"]=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof e?"undefined":(0,l["default"])(e)));t.prototype=(0,a["default"])(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(s["default"]?(0,s["default"])(t,e):t.__proto__=e)}},function(t,e,i){t.exports={"default":i(81),__esModule:!0}},function(t,e,i){i(82),t.exports=i(19).Object.setPrototypeOf},function(t,e,i){var n=i(17);n(n.S,"Object",{setPrototypeOf:i(51).set})},function(t,e,i){t.exports={"default":i(84),__esModule:!0}},function(t,e,i){var n=i(5);t.exports=function(t,e){return n.create(t,e)}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),o=r(s),a=i(2),u=r(a),l=i(6),h=i(86),c=n(h),f=function(){function t(){(0,o["default"])(this,t)}return(0,u["default"])(t,null,[{key:"clamp",value:function(t,e,i){return Math.min(i,Math.max(e,t))}},{key:"get2DClosest",value:function(t,e,i){for(var n=0,r=t.length,s=null,o=[];r>n;++n)s=this.distance(t[n].x,t[n].y,e,i+t[n].height/2),s.index=n,s.width=t[n].width,s.height=t[n].height,o.push(s);return function(t){for(var e=0,i=0,n=null,r=t.length;r>e;++e){for(i=e,n=t[i];i>0&&t[i-1].y>n.y;--i)t[i]=t[i-1];t[i]=n}}(o),o[o.length-1].index}},{key:"linearIntersect",value:function(t,e,i,n,r,s,o){return Math.abs(2*(r-t*o)+-(i*o))<=i*o&&Math.abs(2*(s-e*o)+-(n*o))<=n*o}},{key:"cubicCollision",value:function(t,e,i,n,r,s,o,a){return!(s>e+n||e>s+a||r>t+i||t>r+o)}},{key:"roundTo",value:function(t,e){return e=1/e,Math.round(t*e)/e}},{key:"zoomScale",value:function(t){return t>=0?t+1:0>t?-t+1:t+1}},{key:"hypot",value:function(t,e){return Math.sqrt(t*t+e*e)}},{key:"pointIntersectsCircle",value:function(t,e,i,n,r){return Math.pow(t-i,2)+Math.pow(e-n,2)<=Math.pow(r,2)}},{key:"distance",value:function(t,e,i,n){var r=Math.sqrt(Math.pow(t-i,2)),s=Math.sqrt(Math.pow(e-n,2));return{x:0>t-i?-r:r,y:0>e-n?-s:s}}},{key:"ease",value:function(t){return.5+Math.sin((t-.5)*Math.PI)/2}},{key:"getTilePosition",value:function(t,e,i){var n=-1,t=t,e=e;switch(i){case l.LEFT:t-=l.DIMENSION,n=3;break;case l.UP:e-=l.DIMENSION,n=1;break;case l.RIGHT:t+=l.DIMENSION,n=2;break;case l.DOWN:e+=l.DIMENSION,n=0;break;default:n=0}return{x:t,y:e,facing:n}}},{key:"Seed",get:function(){return function(){function t(e){(0,o["default"])(this,t),this.seed=e,this.generator=c.create(this.seed)}return(0,u["default"])(t,[{key:"random",value:function(){return this.generator(1e9)}}]),t}()}},{key:"Point",get:function(){return function(){function t(e,i){(0,o["default"])(this,t),this.x=e||0,this.y=i||0}return(0,u["default"])(t,[{key:"set",value:function(t,e){this.x=t,this.y=e}},{key:"round",value:function(){this.x<<=0,this.y<<=0}}]),t}()}}]),t}();e["default"]=f},function(t,e,i){"use strict";var n=i(87),r=function(){var t=4022871197,e=function(e){if(e){e=e.toString();for(var i=0;i<e.length;i++){t+=e.charCodeAt(i);var n=.02519603282416938*t;t=n>>>0,n-=t,n*=t,t=n>>>0,n-=t,t+=4294967296*n}return 2.3283064365386963e-10*(t>>>0)}t=4022871197};return e},s=function(t){return function(){var e,i,s=48,o=1,a=s,u=new Array(s),l=0,h=new r;for(e=0;s>e;e++)u[e]=h(Math.random());var c=function(){++a>=s&&(a=0);var t=1768863*u[a]+2.3283064365386963e-10*o;return u[a]=t-(o=0|t)},f=function(t){return Math.floor(t*(c()+1.1102230246251565e-16*(2097152*c()|0)))};f.string=function(t){var e,i="";for(e=0;t>e;e++)i+=String.fromCharCode(33+f(94));return i};var d=function(){var t=Array.prototype.slice.call(arguments);for(e=0;e<t.length;e++)for(i=0;s>i;i++)u[i]-=h(t[e]),u[i]<0&&(u[i]+=1)};return f.cleanString=function(t){return t=t.replace(/(^\s*)|(\s*$)/gi,""),t=t.replace(/[\x00-\x1F]/gi,""),t=t.replace(/\n /,"\n")},f.hashString=function(t){for(t=f.cleanString(t),h(t),e=0;e<t.length;e++)for(l=t.charCodeAt(e),i=0;s>i;i++)u[i]-=h(l),u[i]<0&&(u[i]+=1)},f.seed=function(t){"undefined"!=typeof t&&null!==t||(t=Math.random()),"string"!=typeof t&&(t=n(t,function(t,e){return"function"==typeof e?e.toString():e})),f.initState(),f.hashString(t)},f.addEntropy=function(){var t=[];for(e=0;e<arguments.length;e++)t.push(arguments[e]);d(l++ +(new Date).getTime()+t.join("")+Math.random())},f.initState=function(){for(h(),e=0;s>e;e++)u[e]=h(" ");o=1,a=s},f.done=function(){h=null},"undefined"!=typeof t&&f.seed(t),f.range=function(t){return f(t)},f.random=function(){return f(Number.MAX_VALUE-1)/Number.MAX_VALUE},f.floatBetween=function(t,e){return f.random()*(e-t)+t},f.intBetween=function(t,e){return Math.floor(f.random()*(e-t+1))+t},f}()};s.create=function(t){return new s(t)},t.exports=s},function(t,e){function i(t,e,i,r){return JSON.stringify(t,n(e,r),i)}function n(t,e){var i=[],n=[];return null==e&&(e=function(t,e){return i[0]===e?"[Circular ~]":"[Circular ~."+n.slice(0,i.indexOf(e)).join(".")+"]"}),function(r,s){if(i.length>0){var o=i.indexOf(this);~o?i.splice(o+1):i.push(this),~o?n.splice(o,1/0,r):n.push(r),~i.indexOf(s)&&(s=e.call(this,r,s))}else i.push(s);return null==t?s:t.call(this,r,s)}}e=t.exports=i,e.getSerialize=n},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Language=void 0;var r=i(1),s=n(r),o=i(2),a=n(o),u=function(){function t(){(0,s["default"])(this,t),this.packets={},this.activePacket=null}return(0,a["default"])(t,[{key:"get",value:function(t){return this.activePacket[t]}},{key:"switch",value:function(){}}]),t}();e.Language=new u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){(0,o.ajax)(t).then(JSON.parse).then(function(i){i.path=(0,o.getPath)(t);var n=new d["default"](this,i,function(){return n.instance=this,this.maps[n.name]=n,this.currentMap=this.maps[n.name],null!==this.editor&&(this.editor.map=this.currentMap),n.settings.music&&c.BGM&&h["default"].playSong(n.settings.music,c.VOLUME.MUSIC,!0),this.notify(n,n.name+n.name+n.name+n.name,"MapMessage"),e()}.bind(this))}.bind(this))}function s(t,e){var i=u["default"].distance(t.position.x+t.size.x/2+t.xMargin,t.position.y+t.size.y/2+t.position.z+t.yMargin,(e.size.x/2-e.position.x)/e.resolution,(e.size.y/2-e.position.y)/e.resolution);return i.x/=100,i.y/=100,i}Object.defineProperty(e,"__esModule",{value:!0}),e.addMap=r,e.distance=s;var o=i(7),a=i(85),u=n(a),l=i(90),h=n(l),c=i(6),f=i(91),d=n(f)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=n(r),o=i(2),a=n(o),u=function(){function t(){(0,s["default"])(this,t),this.path="assets/audio/",this.noises=[]}return(0,a["default"])(t,[{key:"playSound",value:function(t,e,i,n){var r=this.path+(t+".ogg");new Howl({urls:[r],autoplay:!0,loop:!1,pos3d:[i,n,e/1e3]})}},{key:"playSong",value:function(t,e,i){e/=100;var n=this.path+(t+".ogg"),r=new Howl({urls:[n],autoplay:!0,loop:!0,volume:i?0:e});i&&r.fadeIn(e,2e3)}},{key:"playNoise",value:function(t,e,i,n){var r=this.path+(t+".ogg"),s=new Howl({urls:[r],autoplay:!0,loop:!0,volume:e/100,pos3d:[i,n,e/1e3]});return this.noises.push(s),s.isInView=!0,s.fadingIn=!1,s.fadingOut=!1,s}}]),t}();e["default"]=u=new u},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(92),o=r(s),a=i(65),u=r(a),l=i(1),h=r(l),c=i(2),f=r(c),d=i(70),p=r(d),y=i(79),v=r(y),g=i(6),m=i(85),E=(r(m),i(7)),x=i(95),_=r(x),S=i(98),w=r(S),M=i(62),b=(r(M),i(99)),T=r(b),O=i(102),I=n(O),N=i(89),P=n(N),A=function(t){function e(t,i,n){(0,h["default"])(this,e);var r=(0,p["default"])(this,(0,u["default"])(e).call(this,null));return r.instance=t,r.tileset=i.tileset,r.texture=null,r.buffers=[],r.mainBuffer=null,r.width=i.width,r.height=i.height,r.name=i.name,r.layers=i.layers,r.objects={},r.objTpl=[],r.objectTemplates={},r.entities=[],r.mapPath=i.path,r.path=null,r.collisionLayer=null,r.settings={},r.xMargin=0,r.yMargin=0,(0,E.getSprite)(r.tileset,-1,-1,function(){this.texture=E.TextureCache[this.tileset],this.parseLayers(),this.path=new T["default"](this),E.Maps[this.name]=this,this.loadMapFile(function(){n instanceof Function&&n()}.bind(this))}.bind(r)),r}return(0,v["default"])(e,t),(0,f["default"])(e,[{key:"loadMapFile",value:function(t){var e=this.mapPath+this.name.toLowerCase()+".js";(0,E.ajax)(e).then(function(e){var i=new Function(e)();this.entities=i.entities,this.settings=i.settings,this.loadMapObjectTypes(),this.loadMapObjects(function(){return t instanceof Function?t():void 0})}.bind(this))}},{key:"loadMapObjectTypes",value:function(){for(var t=0,e=this.entities.length,i=null;e>t;++t)i=this.entities[t],this.objTpl.indexOf(i.type)<=-1&&this.objTpl.push(i.type)}},{key:"loadMapObjects",value:function(t){var e=this,i=this.objTpl.length,n=!0,r=!1,s=void 0;try{for(var a,u=function(){var n=a.value,r=e.mapPath+"objects/"+n;(0,E.ajax)(r+".json").then(JSON.parse).then(function(e){return e.sprite=r+".png",this.objects[n]=e,--i<=0?(this.buildEntities(),t()):void 0}.bind(e))},l=(0,o["default"])(this.objTpl);!(n=(a=l.next()).done);n=!0)u()}catch(h){r=!0,s=h}finally{try{!n&&l["return"]&&l["return"]()}finally{if(r)throw s}}}},{key:"buildEntities",value:function(){var t=0,e=0,i=null;for(e=this.entities.length;e>t;++t)i=this.entities[t].type,this.objectTemplates[i]=this.objects[this.entities[t].type],this.entities[t]=this.addEntity(this.inheritProperties(this.entities[t],this.objects[this.entities[t].type]))}},{key:"inheritProperties",value:function(t,e){var i=null;for(i in e)t.hasOwnProperty(i)===!1&&(t[i]=e[i]);return t}},{key:"addEntity",value:function(t){return new _["default"](t)}},{key:"parseLayers",value:function(){var t=this.width*(2*g.DIMENSION)<<0,e=this.height*(2*g.DIMENSION)<<0,i=null,n=null,r=null;for(n in this.layers)r=this.layers[n],r.collision!==!0?(i=(0,E.createCanvasBuffer)(t,e),this.renderLayer(i,r.data),this.buffers.push(i),i=null):this.collisionLayer=r;this.mainBuffer=this.buffers[0],this.joinLayers()}},{key:"joinLayers",value:function(){for(var t=1;t<this.buffers.length;++t)this.mainBuffer.drawImage(this.buffers[t].canvas,0,0)}},{key:"renderLayer",value:function(t,e){for(var i=2*g.DIMENSION,n=0,r=0,s=0,o=0,a=0,u=this.texture.effect_sprites[0].canvas,l=e.length,h=0;l>a;++a){for(!(o=r=0)&&(h=e[a].length)>0;h>o;++o)n=e[a][o]-1,t.drawImage(u,n%i*i,(n/i<<0)*i,i,i,r,s,i,i),r+=i;s+=i}}}]),e}(w["default"]);e["default"]=A,(0,E.inherit)(A,I),(0,E.inherit)(A,P)},function(t,e,i){t.exports={"default":i(93),__esModule:!0}},function(t,e,i){i(34),i(11),t.exports=i(94)},function(t,e,i){var n=i(44),r=i(50);t.exports=i(19).getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(65),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=i(70),c=n(h),f=i(79),d=n(f),p=(i(6),i(96)),y=n(p),v=function(t){function e(t){var i;(0,a["default"])(this,e);var n=(0,c["default"])(this,(0,s["default"])(e).call(this,t));return n.zIndex=void 0===t.zIndex?1:t.zIndex,n.frames=[0,0],n.facing=0,n.opacity=void 0===t.opacity?1:t.opacity,n.scale=void 0===t.scale?1:t.scale,n.frame=1,n.reversed=[0,0],n.reverseShadow=[0,0],void 0!==t.collisionBox&&(n.collisionBox=t.collisionBox),i=n,(0,c["default"])(n,i)}return(0,d["default"])(e,t),(0,l["default"])(e,[{key:"getFrameIndex",value:function(){return 0}}]),e}(y["default"]);e["default"]=v},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(65),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=i(70),c=n(h),f=i(79),d=n(f),p=i(6),y=i(85),v=n(y),g=i(7),m=i(97),E=n(m),x=i(62),_=(n(x),i(98)),S=n(_),w=function(t){function e(t){var i,n;(0,a["default"])(this,e);var r=(0,c["default"])(this,(0,s["default"])(e).call(this,null));return r.name=t.name||null,r.last=new v["default"].Point,r.STATES={JUMPING:!1,LOCK:!1,EDITING:!1,NOISE:!1},r.socket=null,r.renderable=!1,r.jumpable=void 0===t.jumpable?!0:t.jumpable,r.lifeTime=0,r.zIndex=void 0===t.zIndex?1:t.zIndex,r.collidable=t.collidable||!1,r.collisionBox=void 0===t.collisionBox?[]:t.collisionBox,r.texture=null,r.animation=t.animation===!0||!1,r.animationStart=void 0===t.animationStart?0:t.animationStart,r.animationSpeed=void 0===t.animationSpeed?300:t.animationSpeed,r.loop=void 0===t.loop?!1:t.loop,r.animationFrames=void 0===t.animationFrames?0:t.animationFrames,r.frames=void 0===t.frames?[0]:t.frames,r.sFrame=0,r.frame=0,r.lastFrame=0,r.opacity=0,r.gravity=p.GRAVITY,r.sprite=t.sprite,r.reversed=[2,3,0,1],r.reverseShadow=[2,3,1,0],r.scale=void 0===t.scale?1:t.scale,r.animations=[],r.shadow=null,r.hasShadow=void 0===t.shadow?!0:t.shadow,r.animationIndex=0,r.xMargin=void 0===t.xMargin?0:t.xMargin,r.yMargin=void 0===t.yMargin?0:t.yMargin,r.width=0,r.height=0,r.x=0,r.y=0,r.z=0,r.r=0,r.floating=!1,r.absolute=!1,r.velocity=1,r.orbit=!1,r.orbitAngle=0,r.orbitTarget=null,r.stopOrbit=!1,r.idleTime=0,void 0!==t.x&&void 0!==t.y&&(r.x=t.x,r.y=t.y),t.width&&(r.width=t.width),t.height&&(r.height=t.height),r.shadowX=void 0===t.shadowX?0:t.shadowX,r.shadowY=void 0===t.shadowY?-r.height/2:t.shadowY,r.glTexture=null,r.type=r.getEntityType(),r.noise=void 0===t.noise?null:t.noise,r.noiseRadius=void 0===t.noiseRadius?0:t.noiseRadius,r.following=void 0===t.following?null:t.following,r.followTarget=new v["default"].Point,r.leader=null,r.onAction=null,r.onLoad=null,r.onEnter=null,r.onLeave=null,r.onCollide=null,r.onJump=null,void 0!==t.onAction&&(r.onAction=t.onAction),void 0!==t.onLoad&&(r.onLoad=t.onLoad),void 0!==t.onEnter&&(r.onEnter=t.onEnter),void 0!==t.onLeave&&(r.onLeave=t.onLeave),void 0!==t.onCollide&&(r.onCollide=t.onCollide),void 0!==t.onJump&&(r.onJump=t.onJump),Object.defineProperty(r,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(r,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),Object.defineProperty(r,"z",{get:function(){return this.position.z},set:function(t){this.position.z=t}}),r.z=void 0===t.z?0:t.z,Object.defineProperty(r,"r",{get:function(){return this.position.r},set:function(t){this.position.r=t}}),r.r=void 0===t.r?0:t.r,Object.defineProperty(r,"lock",{get:function(){return this.STATES.LOCK},set:function(t){this.STATES.LOCK=t===!0}}),p.IS_CLIENT===!1?(i=void 0,(0,c["default"])(r,i)):null===r.sprite?(n=void 0,(0,c["default"])(r,n)):((0,g.getSprite)(r.sprite,r.width,r.height,function(t){this.texture=t,this.setup()}.bind(r)),r)}return(0,d["default"])(e,t),(0,l["default"])(e,[{key:"setup",value:function(){if(this.hasShadow===!0&&(this.shadow=new E["default"](this),this.shadow.position.set(this.shadowX,this.shadowY)),p.WGL_SUPPORT===!0&&(this.glTexture=window.game.engine.renderer.glRenderer.bufferTexture(this.texture.effect_sprites[0].canvas)),null!==this.following){var t=g.Maps[this.map].instance.getEntityByProperty(this.following,"name");if(t.leader=this,t.last.x<=0||t.last.y<=0){var e=t.getLastPosition();this.x=t.x+e.x,this.y=t.y+e.y}else this.x=t.last.x,this.y=t.last.y;this.facing=t.facing,t.followTarget.x=this.x,t.followTarget.y=this.y}null!==this.onLoad&&this.onLoad instanceof Function&&this.onLoad()}},{key:"getEntityType",value:function(){return this instanceof e?p.TYPES.Player:p.TYPES.MapEntity}},{key:"orbitAround",value:function(t){null!==t?(this.orbit=!0,this.orbitTarget=t):this.orbit=!1}},{key:"refreshState",value:function(){this.STATES.JUMPING=0!==this.z}},{key:"jump",value:function(t){this.jumpable!==!1&&(this.refreshState(),this.STATES.JUMPING!==!0&&this.STATES.LOCK!==!0&&(this.STATES.JUMPING=!0,this.idleTime=0,this.jumpCB=t||null))}},{key:"jumping",value:function(){this.z+=this.gravity,this.refreshState(),this.z<0?this.gravity+=.1:(this.gravity=p.GRAVITY,this.z=0,this.updateShadow(),this.refreshState(),this.jumpCB&&this.jumpCB())}},{key:"updateShadow",value:function(){this.hasShadow===!0&&(this.z<0?(this.shadow.position.x=-(this.z/2),this.shadow.position.y=this.shadowY-this.z,this.shadow.scale.x=this.z,this.shadow.scale.y=this.z):(this.shadow.position.x=this.shadowX,this.shadow.position.y=this.shadowY,this.shadow.scale.x=0,this.shadow.scale.y=0))}},{key:"animate",value:function(){if(this.STATES.JUMPING===!0&&this.jumping(),!(this.animations.length<=0)){this.animationIndex=0;for(var t=0;t<this.animations.length;++t)this[this.animations[this.animationIndex].type](this.animations[this.animationIndex]),this.animationIndex++}}},{key:"stopAnimation",value:function(){this.animations.splice(this.animationIndex,1)}},{key:"customOpacity",value:function(){return 1!==this.opacity&&0!==this.opacity}},{key:"fadeIn",value:function(){var t=arguments.length<=0||void 0===arguments[0]?t||1:arguments[0],e=arguments[1];this.animations.push({type:"fade",fade:1,speed:t}),this.fadeInCB=e||null}},{key:"fadeOut",value:function(){var t=arguments.length<=0||void 0===arguments[0]?t||1:arguments[0],e=arguments[1],i=arguments[2];this.animations.push({type:"fade",fade:0,kill:e,speed:t}),this.fadeOutCB=i||null}},{key:"fade",value:function(t){var e=t.speed/4/10;this.opacity+=1===t.fade?e:-e,1===t.fade&&this.opacity>1?(this.opacity=1,this.stopAnimation(),null!==this.fadeInCB&&(this.fadeInCB(),this.fadeInCB=null)):0===t.fade&&this.opacity<0&&(this.opacity=t.kill===!0?-.01:0,null!==this.fadeOutCB&&this.fadeOutCB(),this.stopAnimation())}},{key:"shadowFacing",value:function(t){return this.reverseShadow[t]}},{key:"reverseDir",value:function(t){return this.reversed[t]}},{key:"facingToKey",value:function(t){return t===p.LEFT?37:t===p.UP?38:t===p.RIGHT?39:t===p.DOWN?40:38}},{key:"keyToFacing",value:function(t){return 37===t?p.LEFT:38===t?p.UP:39===t?p.RIGHT:40===t?p.DOWN:p.UP}},{key:"oppositFacing",value:function(t){return t===p.LEFT?p.RIGHT:t===p.RIGHT?p.LEFT:t===p.DOWN?p.UP:t===p.UP?p.DOWN:p.UP}}]),e}(S["default"]);e["default"]=w},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(65),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=i(70),c=n(h),f=i(79),d=n(f),p=i(6),y=i(85),v=(n(y),i(98)),g=n(v),m=i(7),E=i(63),x=function(t){function e(t){(0,a["default"])(this,e);var i=(0,c["default"])(this,(0,s["default"])(e).call(this,null));return i.parent=t,i.texture=null,i.sprites=[],i.scale.set(0,0),i.init(),i}return(0,d["default"])(e,t),(0,l["default"])(e,[{key:"init",value:function(){this.texture=this.buildShadow()}},{key:"buildShadow",value:function(){var t=0,e=0,i=null,n=this.parent.texture,r=0,s=0;for(e=n.sprites.length;e>t;++t)r=n.sprites[t].canvas.width,s=n.sprites[t].canvas.height,i=(0,m.createCanvasBuffer)(r,s),i.translate(0,s),i.scale(1,-1),this.drawShadow(n.sprites[t],i,r,s),i.setTransform(1,0,0,1,0,0),this.sprites[t]=i,i=null;return this}},{key:"drawShadow",value:function(t,e,i,n){e.clear(),e.drawImage(t.canvas,0,0,i,n),this.drawTint(e,0,0,i,n,100*p.SHADOW_ALPHA)}},{key:"drawTint",value:function(t,e,i,n,r,s){var o=t.getImageData(e,i,n,r);(0,E.colorizePixels)(o,0,0,s,!0),t.putImageData(o,e,i)}}]),e}(g["default"]);e["default"]=x},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=n(r),o=i(7),a=i(85),u=n(a),l=function h(t,e,i,n){(0,s["default"])(this,h),this.id=(0,o.uHash)(),this.position=new u["default"].Point(void 0!==t?t:0,void 0!==e?e:0),this.size=new u["default"].Point(void 0!==i?i:0,void 0!==n?n:0),this.scale=new u["default"].Point(1,1),Object.defineProperty(this,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t},configurable:!0,enumerable:!0}),Object.defineProperty(this,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t},configurable:!0,enumerable:!0}),Object.defineProperty(this,"width",{get:function(){return this.size.x},set:function(t){this.size.x=t},configurable:!0,enumerable:!0}),Object.defineProperty(this,"height",{get:function(){return this.size.y},set:function(t){this.size.y=t},configurable:!0,enumerable:!0})};e["default"]=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=n(r),o=i(2),a=n(o),u=i(6),l=i(100),h=n(l),c=function(){function t(e){(0,s["default"])(this,t),this.instance=e,this.grid=new h["default"].Graph(this.instance.collisionLayer.data)}return(0,a["default"])(t,[{key:"getShortestPath",value:function(t,e,i,n){return h["default"].astar.search(this.grid,this.grid.grid[(t<<0)/u.DIMENSION][(e<<0)/u.DIMENSION],this.grid.grid[(i<<0)/u.DIMENSION][(n<<0)/u.DIMENSION])}}]),t}();e["default"]=c},function(t,e,i){var n,r,s;(function(t){"use strict";function e(t){return t&&t.__esModule?t:{"default":t}}var o=i(71),a=e(o);!function(e){if("object"===(0,a["default"])(t)&&"object"===(0,a["default"])(t.exports))t.exports=e();else{var i;r=[],n=e,s="function"==typeof n?n.apply(i,r):n,!(void 0!==s&&(t.exports=s))}}(function(){function t(t){for(var e=t,i=[];e.parent;)i.unshift(e),e=e.parent;return i}function e(){return new r(function(t){return t.f})}function i(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var i=0;i<t.length;i++){this.grid[i]=[];for(var r=0,s=t[i];r<s.length;r++){var o=new n(i,r,s[r]);this.grid[i][r]=o,this.nodes.push(o)}}this.init()}function n(t,e,i){this.x=t,this.y=e,this.weight=i}function r(t){this.content=[],this.scoreFunction=t}var s={search:function(i,n,r,o){i.cleanDirty(),o=o||{};var a=o.heuristic||s.heuristics.manhattan,u=o.closest||!1,l=e(),h=n;for(n.h=a(n,r),i.markDirty(n),l.push(n);l.size()>0;){var c=l.pop();if(c===r)return t(c);c.closed=!0;for(var f=i.neighbors(c),d=0,p=f.length;p>d;++d){var y=f[d];if(!y.closed&&!y.isWall()){var v=c.g+y.getCost(c),g=y.visited;(!g||v<y.g)&&(y.visited=!0,y.parent=c,y.h=y.h||a(y,r),y.g=v,y.f=y.g+y.h,i.markDirty(y),u&&(y.h<h.h||y.h===h.h&&y.g<h.g)&&(h=y),g?l.rescoreElement(y):l.push(y))}}}return u?t(h):[]},heuristics:{manhattan:function(t,e){var i=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return i+n},diagonal:function(t,e){var i=1,n=Math.sqrt(2),r=Math.abs(e.x-t.x),s=Math.abs(e.y-t.y);return i*(r+s)+(n-2*i)*Math.min(r,s)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};return i.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)s.cleanNode(this.nodes[t])},i.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)s.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},i.prototype.markDirty=function(t){this.dirtyNodes.push(t)},i.prototype.neighbors=function(t){var e=[],i=t.x,n=t.y,r=this.grid;return r[i-1]&&r[i-1][n]&&e.push(r[i-1][n]),r[i+1]&&r[i+1][n]&&e.push(r[i+1][n]),r[i]&&r[i][n-1]&&e.push(r[i][n-1]),r[i]&&r[i][n+1]&&e.push(r[i][n+1]),this.diagonal&&(r[i-1]&&r[i-1][n-1]&&e.push(r[i-1][n-1]),r[i+1]&&r[i+1][n-1]&&e.push(r[i+1][n-1]),r[i-1]&&r[i-1][n+1]&&e.push(r[i-1][n+1]),r[i+1]&&r[i+1][n+1]&&e.push(r[i+1][n+1])),e},i.prototype.toString=function(){for(var t=[],e=this.grid,i=0;i<e.length;i++){for(var n=[],r=e[i],s=0;s<r.length;s++)n.push(r[s].weight);t.push(n.join(" "))}return t.join("\n")},n.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},n.prototype.getCost=function(t){return t&&t.x!=this.x&&t.y!=this.y?1.41421*this.weight:this.weight},n.prototype.isWall=function(){return 0===this.weight},r.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),i=this.content.pop();e!==this.content.length-1&&(this.content[e]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var i=(t+1>>1)-1,n=this.content[i];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[i]=e,this.content[t]=n,t=i}},bubbleUp:function(t){for(var e=this.content.length,i=this.content[t],n=this.scoreFunction(i);;){var r,s=t+1<<1,o=s-1,a=null;if(e>o){var u=this.content[o];r=this.scoreFunction(u),n>r&&(a=o)}if(e>s){var l=this.content[s],h=this.scoreFunction(l);(null===a?n:r)>h&&(a=s)}if(null===a)break;this.content[t]=this.content[a],this.content[a]=i,t=a}}},{astar:s,Graph:i}})}).call(e,i(101)(t))},function(t){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e,i){var n=t[i];null!==n&&(void 0!==n.JavaScript&&n.JavaScript.bind(t)(e,this),void 0!==n.EngelScript?this.instance.environment.run(e,t,n.EngelScript):void 0===n.JavaScript&&n instanceof Function&&n.bind(t)(e,this))}function s(t,e){for(var i=this.entities,n=0,r=i.length,s=null,o=e.id,a=t.x<<0,u=t.y<<0;r>n;++n)s=i[n],s.id!==o&&s.x<<0===a&&s.y<<0===u&&this.triggerEvent(s,e,"onAction")}function o(t,e){var i=c["default"].getTilePosition(t.x<<0,t.y<<0,e<<0);return 0===this.collisionLayer.data[(i.y<<0)/l.DIMENSION][(i.x<<0)/l.DIMENSION]||this.isEntityCollidable(t,i.x,i.y)===!0}function a(t,e,i){for(var n=this.entities,r=0,s=n.length,o=!1,a=!1,u=t.id,h=null;s>r;++r)h=n[r],h.id!==u&&(o=c["default"].linearIntersect(h.position.x<<0,h.position.y<<0,c["default"].roundTo(h.size.x,l.DIMENSION)*h.scale+h.xMargin-l.DIMENSION,c["default"].roundTo(h.size.y,l.DIMENSION)*h.scale+h.yMargin-l.DIMENSION,e,i,1),h.collidable===!0?h.collisionBox.length>0?this.collidesWithCollisionBox(h,e,i)===!0&&(this.triggerEvent(h,t,"onCollide"),a=!0):o===!0&&(this.triggerEvent(h,t,"onCollide"),a=!0):(c["default"].linearIntersect(h.position.x<<0,h.position.y<<0,c["default"].roundTo(h.size.x,l.DIMENSION)*h.scale+h.xMargin-l.DIMENSION,c["default"].roundTo(h.size.y,l.DIMENSION)*h.scale+h.yMargin-l.DIMENSION,t.position.x<<0,t.position.y<<0,1)===!0&&this.triggerEvent(h,t,"onLeave"),o===!0&&this.triggerEvent(h,t,"onEnter")));return a}function u(t,e,i){for(var n=0,r=0,s=0,o=0,a=l.DIMENSION*t.scale,u=(c["default"].roundTo(t.size.x,l.DIMENSION)+t.xMargin)/l.DIMENSION,h=(c["default"].roundTo(t.size.y,l.DIMENSION)+t.yMargin)/l.DIMENSION,f=u*h,d=t.position.x<<0,p=t.position.y<<0;f>r;++r){if(n=t.collisionBox[o+s],1===n&&d+s*a===e&&p+o/u*a===i)return!0;++s,s>=u&&(o+=u,s=0)}return!1}Object.defineProperty(e,"__esModule",{value:!0}),e.triggerEvent=r,e.actionTrigger=s,e.isObstacle=o,e.isEntityCollidable=a,e.collidesWithCollisionBox=u;var l=i(6),h=i(85),c=n(h)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){var i=0,n=0,r=0,o=0,u=0;if(s.BGS===!1&&(e.x=99999,e.y=99999,i=0,t.noise._audioNode[0].gain.value=0),i=t.noiseRadius-s.DIMENSION||s.DIMENSION,n=i/2,r=i/2,o=Math.floor(100*e.x)+n,u=Math.floor(100*e.y)+r,t.STATES.NOISE===!1&&(t.noiseSrcPath=t.noise,t.noise=l["default"].playNoise(t.noise,s.VOLUME.ENTITY_NOISE,e.x,e.y),t.STATES.NOISE=!0),a["default"].pointIntersectsCircle(o,u,n,r,i)===!0){if(t.noise.isInView===!1){var h=t.noise._audioNode[0];t.noise.fadingIn=!0;var c=h.context.currentTime,f=c+1;h.gain.linearRampToValueAtTime(h.gain.value,c),h.gain.linearRampToValueAtTime(s.VOLUME.ENTITY_NOISE/100,f),t.noise.isInView=!0}}else if(t.noise.isInView===!0){var h=t.noise._audioNode[0];t.noise.fadingOut=!0;var c=h.context.currentTime,f=c+1;h.gain.linearRampToValueAtTime(h.gain.value,c),h.gain.linearRampToValueAtTime(0,f),t.noise.isInView=!1}t.noise.pos3d(e.x,e.y,0)}Object.defineProperty(e,"__esModule",{value:!0}),e.updateEntityNoise=r;var s=i(6),o=i(85),a=n(o),u=i(90),l=n(u)},function(t,e,i){"use strict";function n(){if(null!==this.currentMap){var t=0,e=0,i=null,n=this.currentMap.entities;for(e=n.length;e>t;++t)i=n[t],i.idleTime++,i.renderable=this.updateEntity(i),i.opacity<0?(this.removeEntity(i),--e,--t):null!==i.noise&&this.updateEntityNoise(i,this.currentMap.distance(i,this.camera))}}function r(t){t.orbitAngle+=2*t.velocity*Math.PI/180;var e=t.orbitTarget,i=(e.size.x*e.scale+e.size.y*e.scale)/u.DIMENSION*2,n=i-u.DIMENSION/2,r=i-u.DIMENSION/2;n+=e.xMargin,r+=e.yMargin/2,t.x=e.position.x+n+i*Math.cos(t.orbitAngle),t.y=e.position.y+r+i*Math.sin(t.orbitAngle),t.stopOrbit===!0&&(t.x<<0)%8===0&&(t.y<<0)%8===0&&(t.x=math.roundTo(t.x,u.DIMENSION),t.y=math.roundTo(t.y,u.DIMENSION),t.orbitAround(null),t.stopOrbit=!1)}function s(t){t.z+=t.gravity/5,t.z<0?t.gravity+=.02:(t.gravity=u.GRAVITY,t.z=0,t.updateShadow(),t.refreshState()),t.updateShadow()}function o(t){return t.lifeTime>0&&this.renderer.now>=t.lifeTime&&(t.lifeTime=0,t.fadeOut(1,!0)),t.animate(),t.orbit===!0&&this.orbit(t),t.floating===!0&&this["float"](t),0!==t.z&&t.updateShadow(),t.absolute===!0?this.isRenderable(t)===!0:this.camera.isInView(t.position.x+t.xMargin,t.position.y+t.yMargin,t.size.x*t.scale,2*t.size.y*t.scale+t.shadowY)===!1?!1:this.isRenderable(t)!==!1}function a(t){return null!==t.texture&&0!==t.opacity}Object.defineProperty(e,"__esModule",{value:!0}),e.logic=n,e.orbit=r,e["float"]=s,e.updateEntity=o,e.isRenderable=a;var u=i(6)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t){t.isLocalPlayer&&(t.instance=this.instance,this.localEntity=t),t.customOpacity()===!1&&t.fadeIn(1),t.noise&&void 0!==t.noise._audioNode&&t.noise._audioNode[0].gain.linearRampToValueAtTime(c.VOLUME.ENTITY_NOISE/100,t.noise._audioNode[0].context.currentTime),this.currentMap.entities.push(t)}function s(t){var e=this.instance.entities,i=this.currentMap,n=null,r=null;if(t instanceof e.Player)r=new e.Player({name:"undefined",map:t.map,x:t.x,y:t.y,zIndex:t.zIndex,sprite:t.sprite,width:t.width,height:t.height,isLocalPlayer:!1,collidable:t.collidable,shadow:t.hasShadow}),t.instance&&(r.instance=t.instance),r.hasShadow&&(r.shadow.x=t.shadow.x,r.shadow.y=t.shadow.y);else{if(!(t instanceof d["default"]))return;r=i.objectTemplates[t.name.toLowerCase()]}return r.x=t.x,r.y=t.y,r.z=t.z,t instanceof d["default"]?(n=new d["default"](t),t.noise&&(n.noiseSrcPath=t.noiseSrcPath,n.noise=n.noiseSrcPath)):n=r,n}function o(t,e){var i=0,n=0;for(n=this.currentMap.entities.length;n>i;++i)if(this.currentMap.entities[i][e]===t)return this.currentMap.entities[i];return-1}function a(t){null!==this.editor.entitySelection&&t.id===this.editor.entitySelection.id&&(this.editor.entitySelection=null),t.noise&&void 0!==t.noise._audioNode&&t.noise._audioNode[0].gain.linearRampToValueAtTime(0,t.noise._audioNode[0].context.currentTime),this.removeEntityFromArray(t,this.currentMap.entities)}function u(t,e){var i=0,n=0,r=t.id,s=null;for(n=e.length;n>i;++i)if(e[i].id===r)return s=e[i],e[i]=null,e.splice(i,1),s}function l(t){var e="id";return this.getEntityByProperty(t,e)}function h(t){var e=null;void 0!==(e=this.getEntityByProperty(t,property))&&this.removeEntity(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.addEntity=r,e.cloneEntity=s,e.getEntityByProperty=o,e.removeEntity=a,e.removeEntityFromArray=u,e.getEntityById=l,e.removeEntityById=h;var c=i(6),f=i(95),d=n(f),p=i(96);n(p)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(65),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=i(70),c=n(h),f=i(79),d=n(f),p=i(6),y=i(85),v=n(y),g=i(98),m=n(g),E=function(t){function e(t){(0,a["default"])(this,e);var i=(0,c["default"])(this,(0,s["default"])(e).call(this,null));return i.instance=t,i.width=t.width,
i.height=t.height,i.drag={px:0,py:0,pz:0,sx:0,sy:0},i.dragging=!1,i.size.set(i.width||0,i.height||0),i.scaling=0,i.resolution=0,i.base=new v["default"].Point(0,0),i.target=new v["default"].Point(0,0),i.objectFocus=null,Object.defineProperty(i,"scale",{get:function(){return this.scaling},set:function(t){this.scaling=t,this.refreshResolution()}}),i}return(0,d["default"])(e,t),(0,l["default"])(e,[{key:"getGameMouseOffset",value:function(t,e){var i=(t-this.x)/this.resolution,n=(e-this.y)/this.resolution;return{x:Math.ceil(i/p.DIMENSION)*p.DIMENSION-p.DIMENSION<<0,y:Math.ceil(n/p.DIMENSION)*p.DIMENSION-p.DIMENSION<<0}}},{key:"move",value:function(t,e){this.x+=t-this.drag.px,this.y+=e-this.drag.py,this.drag.px=t,this.drag.py=e}},{key:"click",value:function(t,e){this.drag.sx=(t-this.x)/this.resolution,this.drag.sy=(e-this.y)/this.resolution,this.drag.px=t,this.drag.py=e}},{key:"refreshResolution",value:function(){this.resolution=v["default"].roundTo(parseFloat(v["default"].zoomScale(this.scale)),p.PIXEL_SCALE)}},{key:"zoom",value:function(t){var e=t.deltaY===-0?t.deltaX:t.deltaY,i=e>0?-100:100;i=i/2/(v["default"].hypot(this.size.x,this.size.y)/Math.PI)*v["default"].zoomScale(this.scale),this.drag.pz=this.resolution,this.scale+=i/2,this.scale<p.MIN_SCALE&&(this.scale=p.MIN_SCALE),this.scale>p.MAX_SCALE&&(this.scale=p.MAX_SCALE);var n=this.objectFocus;p.FREE_CAMERA===!0?(this.position.x-=this.drag.sx*(v["default"].zoomScale(this.resolution)-v["default"].zoomScale(this.drag.pz)),this.position.y-=this.drag.sy*(v["default"].zoomScale(this.resolution)-v["default"].zoomScale(this.drag.pz))):null!==n&&(this.position.x-=(n.position.x+n.size.x*n.scale/2+n.xMargin)*(v["default"].zoomScale(this.resolution)-v["default"].zoomScale(this.drag.pz)),this.position.y-=(n.position.y+(n.size.y*n.scale/2+n.yMargin+n.z))*(v["default"].zoomScale(this.resolution)-v["default"].zoomScale(this.drag.pz)))}},{key:"getX",value:function(t){return this.size.x/2-(t.position.x+t.size.x*t.scale/2+t.xMargin)*this.resolution}},{key:"getY",value:function(t){return this.size.y/2-(t.position.y+(t.size.y*t.scale/2+t.yMargin+t.z))*this.resolution}},{key:"updateFocus",value:function(t){this.base={x:this.position.x,y:this.position.y},this.target={x:this.getX(t),y:this.getY(t)},this.deltaX=this.target.x-this.base.x,this.deltaY=this.target.y-this.base.y}},{key:"animate",value:function(t){if(p.FREE_CAMERA!==!0){this.updateFocus(t);var e=p.EASING_CAMERA===!0?0:v["default"].ease(Math.atan(p.DEBUG_FPS/60+.05)),i=Math.round(100*(this.target.x-(this.base.x+e*this.deltaX)))/100,n=Math.round(100*(this.target.y-(this.base.y+e*this.deltaY)))/100;i!==-0&&0!==i&&(this.position.x+=i),n!==-0&&0!==n&&(this.position.y+=n)}}},{key:"animateFocus",value:function(t){this.updateFocus(t),this.objectFocus=t}},{key:"focus",value:function(t,e){return null!==t&&void 0!==t&&-1!==t?e===!0?(this.objectFocus=t,this.position.x=this.getX(t),void(this.position.y=this.getY(t))):void this.animateFocus(t):void 0}},{key:"inView",value:function(t,e,i,n){return t+i>=0&&t<=this.size.x&&e+n>=0&&e<=this.size.y}},{key:"isInView",value:function(t,e,i,n){return this.inView(t*this.resolution+this.position.x<<0,e*this.resolution+this.position.y<<0,i*this.resolution<<0,n*this.resolution<<0)}}]),e}(m["default"]);e["default"]=E},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(92),o=r(s),a=i(1),u=r(a),l=i(2),h=r(l),c=i(6),f=i(7),d=i(108),p=n(d),y=i(85),v=r(y),g=i(109),m=r(g),E=i(110),x=function(){function t(e){(0,u["default"])(this,t),this.instance=e,this.context=e.context,this.commander=new m["default"],this.map=null,this.camera=null,this.entitySelection=null,this.selection={x1:0,y1:0,x2:0,y2:0},this.selectedEntities=[],this.entityCopy=null,this.pastedEntity=null,this.STATES={DRAGGING:!1,SELECTING:!1},this.drag=new v["default"].Point(0,0),Object.defineProperty(this,"dragging",{get:function(){return this.STATES.DRAGGING},set:function(t){this.STATES.DRAGGING=t}}),this.inheritInstance(e),this.init()}return(0,h["default"])(t,[{key:"inheritInstance",value:function(t){this.map=t.currentMap,this.camera=t.camera}},{key:"init",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=(0,o["default"])(E.commands);!(t=(n=r.next()).done);t=!0){var s=n.value;this.commander.newCommand(s)}}catch(a){e=!0,i=a}finally{try{!t&&r["return"]&&r["return"]()}finally{if(e)throw i}}}},{key:"selectFrom",value:function(t,e){var i=this.camera.getGameMouseOffset(t,e);this.selection.x1=i.x,this.selection.y1=i.y,this.selection.x2=0,this.selection.y2=0}},{key:"selectTo",value:function(t,e){var i=this.camera.getGameMouseOffset(t,e);this.selection.x2=i.x,this.selection.y2=i.y,this.getSelectionRange(this.selection.x1,this.selection.y1,this.selection.x2,this.selection.y2)}},{key:"getSelectionRange",value:function(t,e,i,n){var r=null,s=[],o=0,a=0,u=t>i?i:t-c.DIMENSION,l=e>n?n:e,h=Math.abs(i-t),f=Math.abs(n-e),d=0,p=0;for(a=this.map.entities.length;a>o;++o)r=this.map.entities[o],d=v["default"].roundTo(r.width,c.DIMENSION)*r.scale+(i>=t?-c.DIMENSION:0),p=v["default"].roundTo(r.height,c.DIMENSION)*r.scale,v["default"].linearIntersect(u,l,h+d-c.DIMENSION,f+p-c.DIMENSION,r.x+r.xMargin+d-c.DIMENSION,r.y+r.yMargin+r.z+c.Y_DEPTH_HACK+p-c.DIMENSION,1)&&s.push(r.id);this.selectedEntities=s}},{key:"getEntityByMouse",value:function(t,e){for(var i=null,n=this.camera.getGameMouseOffset(t,e),r=n.x<<0,s=n.y<<0,o=0,a=this.map.entities.length,u=[];a>o;++o)i=this.map.entities[o],v["default"].linearIntersect(v["default"].roundTo(i.position.x,c.DIMENSION),v["default"].roundTo(i.position.y,c.DIMENSION)<<0,v["default"].roundTo(i.width,c.DIMENSION)*i.scale+i.xMargin-c.DIMENSION,v["default"].roundTo(i.height,c.DIMENSION)*i.scale+i.yMargin-c.DIMENSION,r,s,1)===!0&&u.push(i);return u.length<=0?null:u[v["default"].get2DClosest(u,r,s)]}},{key:"dragEntity",value:function(t,e){var i=null,n=null,r=0,s=0;null!==(i=this.entitySelection)&&(c.FREE_CAMERA===!1&&null!==this.camera.objectFocus&&i.id===this.camera.objectFocus.id||(n=this.camera.getGameMouseOffset(t,e),n.x===this.drag.x&&n.y===this.drag.y||(r=n.x-this.drag.x,s=n.y-this.drag.y,this.commander.push("drag",i,[r,s]),this.drag.x=n.x,this.drag.y=n.y)))}},{key:"selectEntity",value:function(t,e){var i=this.getEntityByMouse(t,e),n=this.camera.getGameMouseOffset(t,e);null!==i&&null!==i.texture&&(0,f.tileContainsImageData)(i.texture.sprites[i.sFrame],(n.x-i.x)/i.scale<<0,(n.y-i.y)/i.scale<<0,c.DIMENSION,c.DIMENSION)===!1&&(i=null),this.commander.push("select",this,[i,this.entitySelection]),this.drag.x=n.x,this.drag.y=n.y}},{key:"editEntity",value:function(t,e){var i=this.getEntityByMouse(t,e);null!==i&&console.log(i)}},{key:"deleteEntity",value:function(){null!==this.entitySelection&&this.commander.push("delete",this,[this.entitySelection])}},{key:"cutEntity",value:function(){null!==this.entitySelection&&this.commander.push("cut",this,[this.entitySelection])}},{key:"copyEntity",value:function(){null!==this.entitySelection&&this.commander.push("copy",this,[this.entitySelection,this.entityCopy])}},{key:"pasteEntity",value:function(){this.commander.push("paste",this,[this.entitySelection,this.pastedEntity])}}]),t}();e["default"]=x,(0,f.inherit)(x,p)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(){this.renderSelection(),this.instance.editor.STATES.SELECTING===!0,this.renderEntitySelection()}function s(){var t=0,e=0,i=null,n=this.instance.editor.selectedEntities;e=n.length;for(var r=0,s=0,o=0,a=0,u=0;e>t;++t)i=n[t],r=this.camera.resolution,s=this.camera.x+(i.position.x+i.xMargin)*r<<0,o=this.camera.y+(i.position.y+i.yMargin+i.z)*r<<0,a=i.size.x*r<<0,u=i.size.y*r<<0,this.context.beginPath(),this.context.strokeStyle="red",this.context.lineWidth=r/2<<0,this.context.strokeRect(s,o,a,u),this.context.stroke(),this.context.closePath()}function o(){if(this.instance.editor.STATES.SELECTING!==!1){var t=this.instance.editor.selection,e=this.camera.resolution,i=this.camera.x+t.x1*e<<0,n=this.camera.y+t.y1*e<<0,r=(t.x2-t.x1)*e<<0,s=(t.y2-t.y1)*e<<0;this.context.beginPath(),this.context.strokeStyle="red",this.context.lineWidth=e/2<<0,this.context.strokeRect(i,n,r,s),this.context.stroke(),this.context.closePath()}}function a(){var t=this.instance.editor.entitySelection;if(null!==t&&this.camera.isInView(t.position.x,t.position.y,t.size.x*t.scale,t.size.y*t.scale)!==!1&&0!==t.opacity&&null!==t.texture){var e=this.camera.resolution,i=this.camera.x+(t.position.x+t.xMargin)*e<<0,n=this.camera.y+(t.position.y+t.yMargin+t.z)*e<<0,r=t.size.x*t.scale*e<<0,s=t.size.y*t.scale*e<<0;null!==t.noise&&this.renderEntityNoise(t,i,n,r,s),this.context.beginPath(),this.context.strokeStyle="red",this.context.lineWidth=e/2<<0,this.context.strokeRect(i,n,r,s),this.context.stroke(),this.context.closePath(),this.renderSelectionText(t,i,n),this.context.globalAlpha=.25,t.collidable===!0&&(t.collisionBox.length>0?this.renderEntityCollisionBox(t,i,n):(this.context.fillStyle="red",this.context.fillRect(i,n,r,s),this.context.fill())),this.context.globalAlpha=1}}function u(t,e,i,n,r){var s=this.camera.resolution,o=(t.noiseRadius-c.DIMENSION||c.DIMENSION)*s;e+=n/2,i+=r/2,this.context.globalAlpha=.2,this.context.beginPath(),this.context.fillStyle="green",this.context.lineWidth=s/2<<0,this.context.arc(e,i,o,0,2*Math.PI,!1),this.context.fill(),this.context.closePath(),this.context.globalAlpha=1}function l(t,e,i){for(var n=t.collisionBox,r=this.camera.resolution,s=0,o=0,a=0,u=0,l=c.DIMENSION*t.scale*r,h=t.width/c.DIMENSION,f=t.height/c.DIMENSION,d=h*f;d>o;++o)s=n[u+a],1===s&&(this.context.fillStyle="red",this.context.fillRect(e+a*l,i+u/h*l,l,l),this.context.fill()),++a,a>=h&&(u+=h,a=0)}function h(t,e,i){var n=this.camera.resolution,r="red",s=.5*n,o=2.5*n,a=e,u=i-1.25*s-o,l=1,h="X: "+t.position.x.toFixed(l),c="Y: "+t.position.y.toFixed(l);this.instance.renderer.drawPixelText(h,a,u,o,s,r),this.instance.renderer.drawPixelText(c,a,u+=o,o,s,r)}Object.defineProperty(e,"__esModule",{value:!0}),e.renderEditorMode=r,e.renderSelectedEntities=s,e.renderSelection=o,e.renderEntitySelection=a,e.renderEntityNoise=u,e.renderEntityCollisionBox=l,e.renderSelectionText=h;var c=i(6),f=i(85);n(f)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=n(r),o=i(2),a=n(o),u=function(){function t(){(0,s["default"])(this,t),this.position=-1,this.commands={},this.stack=[]}return(0,a["default"])(t,[{key:"newCommand",value:function(t){this.commands[t.action]=t,t=null}},{key:"push",value:function(t,e,i){var n={action:t,data:i,scope:e};this.stack.splice(this.position+1,this.stack.length),this.stack.push(n),this.redo(),this.undo(),this.redo(),this.undo(),this.redo()}},{key:"fire",value:function(t,e){var i=this.commands[t.action][e];i.bind(t.scope).apply(i,t.data)}},{key:"getCurrentCmd",value:function(){return this.stack[this.position]}},{key:"undo",value:function(){this.position>=0&&(this.fire(this.getCurrentCmd(),"onUndo"),this.position--)}},{key:"redo",value:function(){this.position<this.stack.length-1&&(this.position++,this.fire(this.getCurrentCmd(),"onRedo"))}}]),t}();e["default"]=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.commands=void 0;var n=i(6);e.commands=[{action:"select",onUndo:function(t,e){this.entitySelection=null,this.entitySelection=e},onRedo:function(t){this.entitySelection=null,this.entitySelection=t}},{action:"drag",onUndo:function(t,e){this.x-=t,this.y-=e,this.y<<=0,this.y+=n.Y_DEPTH_HACK,this.last.x=this.x,this.last.y=this.y},onRedo:function(t,e){this.x+=t,this.y+=e,this.y<<=0,this.y+=n.Y_DEPTH_HACK,this.last.x=this.x,this.last.y=this.y}},{action:"delete",onUndo:function(t){this.instance.addEntity(t),this.entitySelection=t},onRedo:function(t){this.instance.removeEntity(t),this.entitySelection=null}},{action:"cut",onUndo:function(){this.instance.editor.pasteEntity()},onRedo:function(){this.instance.editor.copyEntity(),this.instance.editor.deleteEntity()}},{action:"copy",onUndo:function(t,e){this.entityCopy=e,this.entitySelection=e},onRedo:function(t){this.entityCopy=t,this.entitySelection=t}},{action:"paste",onUndo:function(t,e){this.instance.removeEntity(e)},onRedo:function(t,e){var i=this.map;if(null!==e&&void 0!==e)return void i.entities.push(e);var n=this.instance.cloneEntity(t);this.instance.editor.commander.stack[this.instance.editor.commander.position].data[1]=n,i.instance.addEntity(n)}}]},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=n(r),o=i(2),a=n(o),u=(i(6),i(7)),l=i(85),h=n(l),c=i(95),f=(n(c),i(106)),d=n(f),p=function(){function t(e){(0,s["default"])(this,t),this.instance=e,this.camera=new d["default"](this),this.camera.size=this.instance.camera.size,this.camera.position=this.instance.camera.position,this.width=300,this.height=200,this.buffer=null,this.bgBuffer=null,this.frBuffer=null,this.redraw=!0,this.entities={},this.resolution=1,this.position=new h["default"].Point,this.init()}return(0,a["default"])(t,[{key:"init",value:function(){this.buffer=(0,u.createCanvasBuffer)(this.width,this.height),this.bgBuffer=(0,u.createCanvasBuffer)(this.width,this.height),this.frBuffer=(0,u.createCanvasBuffer)(this.width,this.height),this.createEntityBuffer("Player","#DBB78A","#905A23"),this.createEntityBuffer("Entity","#697a21","#c9db8a"),this.createEntityBuffer("LocalPlayer","#119617","#abf4c0"),this.createEntityBuffer("Tree","#697a21","darkgreen"),this.resize(),this.draw()}},{key:"resize",value:function(){this.position.x=this.camera.width-this.width,this.position.y=this.camera.height-this.height}},{key:"inside",value:function(t,e){return h["default"].cubicCollision(t,e,1,1,this.position.x,this.position.y,this.width,this.height)}},{key:"createEntityBuffer",value:function(t,e,i){var n=6,r=16,s=16,o=null;this.entities[t]=(0,u.createCanvasBuffer)(r,s),o=this.entities[t],o.beginPath(),o.arc(r/2,s/2,n,0,2*Math.PI,!1),o.fillStyle=e,o.fill(),o.lineWidth=1.5,o.strokeStyle=i,o.stroke()}},{key:"draw",value:function(t,e){return this.buffer.clear(),this.bgBuffer.clear(),this.frBuffer.clear(),0===t?(this.drawBackground(),void this.drawFront(e)):1===t?void this.drawFront(e):void 0}},{key:"drawBackground",value:function(){this.bgBuffer.strokeStyle="red",this.bgBuffer.strokeRect(0,0,this.width,this.height),this.bgBuffer.stroke()}},{key:"drawFront",value:function(t){var e=null,i=0,n=0;n=t.length;for(var r=this.instance.camera.resolution,s=0,o=this.width/2-(this.camera.size.x/2-this.camera.position.x)/r,a=this.height/2-(this.camera.size.y/2-this.camera.position.y)/r,u=0,l=0,h=0,c=0;n>i;++i)e=t[i],s=e.scale+-e.z/this.resolution/((e.width+e.height)/2),null!==e.texture&&(u=(o+e.x+e.xMargin+e.z/(e.width/2)/2)*this.resolution<<0,l=(a+e.y+e.yMargin+e.z)*this.resolution<<0,h=e.size.x*s<<0,c=e.size.y*s<<0,this.drawEntity(e,u,l,h,c));this.drawCameraViewport(o,a)}},{key:"drawEntity",value:function(t,e,i){var n=null,r=this.instance.instance.entities.Player;n=null!==this.instance.localEntity&&t.id===this.instance.localEntity.id?this.entities.LocalPlayer:t instanceof r?this.entities.Player:"Tree"===t.name?this.entities.Tree:this.entities.Entity,this.bgBuffer.drawImage(n.canvas,e,i)}},{key:"drawCameraViewport",value:function(t,e){var i=this.instance.camera.resolution;this.bgBuffer.lineWidth=1,this.bgBuffer.strokeStyle="red",this.bgBuffer.strokeRect(t-this.camera.position.x/i,e-this.camera.position.y/i,this.camera.size.x/i,this.camera.size.y/i),this.bgBuffer.stroke()}}]),t}();e["default"]=p},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),o=r(s),a=i(2),u=r(a),l=(i(6),i(113)),h=n(l),c=function(){function t(e){(0,o["default"])(this,t),this.instance=e,this.engine=this.instance,this.actions=h.actions,this.logs=[]}return(0,u["default"])(t,[{key:"action",value:function(t){var e,i=arguments.length<=1||void 0===arguments[1]?i||[]:arguments[1],n=this.actions[t],r=(e=this.engine.instance,n.rule).call(e)===!0;r===!0&&n.action.bind(this.engine.instance).apply(this,i),n.log!==!1&&this.log(t,r)}},{key:"log",value:function(t,e){this.logs.push({name:t,success:e,timestamp:this.instance.renderer.now})}}]),t}();e["default"]=c},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.actions=void 0;var r=i(6),s=n(r),o=e.actions={};o.SHIFT={action:function(){this.engine.editor.STATES.SELECTING=!1,this.engine.editor.selectedEntities=[]},rule:function(){return s.EDIT_MODE}},o["CTRL+Z"]={action:function(){this.engine.editor.commander.undo()},rule:function(){return s.EDIT_MODE}},o["CTRL+Y"]={action:function(){this.engine.editor.commander.redo()},rule:function(){return s.EDIT_MODE}},o["CTRL+C"]={action:function(){this.engine.editor.copyEntity()},rule:function(){return s.EDIT_MODE}},o["CTRL+V"]={action:function(){this.engine.editor.pasteEntity()},rule:function(){return s.EDIT_MODE}},o["CTRL+X"]={action:function(){this.engine.editor.cutEntity()},rule:function(){return s.EDIT_MODE}},o.DELETE={action:function(){this.engine.editor.deleteEntity()},rule:function(){return s.EDIT_MODE}},o.F1={action:function(){s.DEBUG_MODE=!s.DEBUG_MODE,s.DEBUG_MODE||(s.FREE_CAMERA=!1,this.engine.camera.focus(this.engine.localEntity,!1)),this.engine.renderer.switchRenderingMode(s.DEBUG_MODE?0:1),this.engine.renderer.resize(!0),this.engine.renderer.clear(),this.engine.renderer.draw()},rule:function(){return!0}},o.F2={action:function(){s.EDIT_MODE=!s.EDIT_MODE},rule:function(){return s.DEBUG_MODE}},o.F3={action:function(){s.FREE_CAMERA=!s.FREE_CAMERA,s.FREE_CAMERA||(this.engine.camera.dragging=!1)},rule:function(){return s.DEBUG_MODE}},o.F4={action:function(){s.GOD_MODE=!s.GOD_MODE},rule:function(){return s.DEBUG_MODE}},o.ESCAPE={action:function(){this.engine.scenes.Pause.active?this.engine.scenes.Pause.hide():this.engine.scenes.Pause.show()},rule:function(){return!0}},o.B={action:function(){this.engine.notify(this.engine.localEntity,"Hello World")},rule:function(){return!0}},o.Z={action:function(){var t=this.engine.localEntity;t.action()},rule:function(){return null!==this.engine.localEntity}},o.X_FIRE={action:function(){var t=this.engine.localEntity;t.velocity=2},rule:function(){return null!==this.engine.localEntity}},o.X_LEAVE={action:function(){var t=this.engine.localEntity;t.velocity=1},rule:function(){return null!==this.engine.localEntity}},o.C={action:function(){var t=this.engine.localEntity;this.engine.activeScene||t.jump()},rule:function(){return null!==this.engine.localEntity}},o["←"]={action:function(){var t=this.engine.localEntity;this.engine.activeScene||t.move(s.LEFT)},rule:function(){return null!==this.engine.localEntity}},o["→"]={action:function(){var t=this.engine.localEntity;this.engine.activeScene||t.move(s.RIGHT)},rule:function(){return null!==this.engine.localEntity}},o["↑"]={action:function(){var t=this.engine.localEntity;this.engine.activeScene||t.move(s.UP)},rule:function(){return null!==this.engine.localEntity}},o["↓"]={action:function(){var t=this.engine.localEntity;this.engine.activeScene||t.move(s.DOWN)},rule:function(){return null!==this.engine.localEntity}},o.SPACE={action:function(){var t=this.engine.localEntity;this.engine.camera.focus(t,!0),s.FREE_CAMERA=!1},rule:function(){return s.FREE_CAMERA||null!==this.engine.camera.objectFocus&&this.engine.camera.objectFocus.id!==this.engine.localEntity.id},log:!1},o.DBLCLICK={action:function(t){if(t.preventDefault(),s.DEBUG_MODE&&(s.FREE_CAMERA=!1,s.EDIT_MODE&&!this.engine.editor.dragging)){var e=this.engine.editor.getEntityByMouse(t.clientX,t.clientY);null!==e&&this.engine.camera.focus(e,!1),this.engine.editor.editEntity(t.clientX,t.clientY)}},rule:function(){return!0},log:!1},o.LEFTCLICK={action:function(t){if(t.target.id===this.engine.node.id){var e=t.touches?t.touches[0].clientX:t.clientX,i=t.touches?t.touches[0].clientY:t.clientY;if(t.preventDefault(),this.input.KeyBoard.isKeyPressed("G"))return void this.engine.ping(e,i,"notify");if(s.DEBUG_MODE){if(s.EDIT_MODE&&1===t.which&&this.input.KeyBoard.isKeyPressed("SHIFT"))return this.engine.editor.STATES.SELECTING=!0,this.engine.editor.selectFrom(e,i),void this.engine.editor.selectTo(e,i);1===t.which||this.input.KeyBoard.isKeyPressed("SPACE")||(s.FREE_CAMERA=!0),s.FREE_CAMERA&&(t.touches||1!==t.which)&&(this.engine.camera.dragging=!0,this.engine.camera.click(e,i)),s.EDIT_MODE&&(t.touches||1===t.which)&&(this.engine.editor.dragging=!0,this.engine.editor.selectEntity(e,i))}}},rule:function(){return!0},log:!1},o.RESIZE={action:function(){this.engine.renderer.resize(!0)},rule:function(){return!0},log:!1},o.MOUSEUP={action:function(t){t.preventDefault(),s.DEBUG_MODE&&(s.FREE_CAMERA&&(this.engine.camera.dragging=!1),s.EDIT_MODE&&(t.touches||1===t.which)&&(this.engine.editor.dragging=!1,this.engine.editor.STATES.SELECTING=!1,this.engine.editor.selectedEntities=[]),this.engine.camera.moving=!1)},rule:function(){return!0},log:!1},o.MOUSEMOVE={action:function(t){var e=t.touches?t.touches[0].clientX:t.clientX,i=t.touches?t.touches[0].clientY:t.clientY;return t.preventDefault(),s.DEBUG_MODE?(s.FREE_CAMERA&&this.engine.camera.dragging&&!this.input.KeyBoard.isKeyPressed("SPACE")&&(this.engine.camera.move(e,i),this.engine.camera.moving=!0),this.input.KeyBoard.isKeyPressed("SHIFT")&&this.engine.editor.STATES.SELECTING?void this.engine.editor.selectTo(e,i):void(s.EDIT_MODE&&this.engine.editor.dragging&&this.engine.editor.dragEntity(e,i))):void 0},rule:function(){return!0},log:!1},o.RIGHTCLICK={action:function(t){t.preventDefault()},rule:function(){return!0},log:!1},o.MOUSEWHEEL={action:function(t){t.preventDefault(),s.FREE_CAMERA&&this.engine.camera.click(t.clientX,t.clientY),this.engine.camera.zoom(t)},rule:function(){return!0},log:!1}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),o=r(s),a=i(2),u=r(a),l=i(115),h=n(l),c=i(116),f=r(c),d=i(119),p=r(d),y=i(120),v=r(y),g=i(124),m=r(g),E=function(){function t(e){(0,o["default"])(this,t),this.instance=e,this.FLAGS={GOT_STARTER_PKMN:!1,COUNTER:0},this.tokenizer=new p["default"](h.TOKENS,h.IGNORE),this.parser=new v["default"],this.evaluator=new m["default"](this),this.tester=new f["default"](this.tokenizer,this.parser,this.evaluator),console.log(this.FLAGS)}return(0,u["default"])(t,[{key:"run",value:function(t,e,i){this.evaluator.setTriggerScope(t),this.evaluator.setGlobalScope(e);var n=this.tokenizer.scan(i),r=this.parser.parse(n);this.evaluator.evaluate(r,function(t){console.log("Ok!",t)})}}]),t}();e["default"]=E},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.TOKENS={"(":"LPAREN",")":"RPAREN","[":"LBRACK","]":"RBRACK","{":"LBRACE","}":"RBRACE",":":"COLON",";":"SEMICOLON",".":"PERIOD","?":"CONDITIONAL",$:"DOLLAR","@":"ATSIGN","!":"NOT","||":"OR","&&":"AND",",":"COMMA","+":"ADD","-":"SUB","*":"MUL","/":"DIV","%":"MOD","^":"POW","+=":"ADDSET","-=":"SUBSET","*=":"MULSET","/=":"DIVSET","%=":"MODSET","<":"LT","<=":"LE",">":"GT",">=":"GE","==":"EQ","!=":"NEQ","=":"ASSIGN","~":"BIT_NOT","|":"BIT_OR","&":"BIT_AND","null":"NULL","true":"TRUE","false":"FALSE","if":"IF","else":"ELSE","while":"WHILE","do":"DO","for":"FOR","function":"FUNCTION","var":"VAR","const":"CONST","return":"RETURN"," ":"BLANK","	":"TAB","\n":"NL","\r":"X","\f":"X1","\x0B":"X2"},e.IGNORE=["BLANK","TAB","NL","X","X1","X2"]},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(92),o=r(s),a=i(1),u=r(a),l=i(2),h=r(l),c=(i(117),i(118)),f=n(c),d=(i(7),function(){function t(e,i,n){(0,u["default"])(this,t),this.tokenizer=e,this.parser=i,this.evaluator=n,this.setup()}return(0,h["default"])(t,[{key:"test",value:function(t,e){var i=this.parser.parse(this.tokenizer.scan(t.expression));this.evaluator.evaluate(i,function(i){i!==t.expect&&(console.log(this.parser.parse(this.tokenizer.scan(t.expression))),console.info("%c ☓ "+t.name+" :: "+t.expression+" = "+i,"color: darkred;"),e(!1)),e(!0)}.bind(this))}},{key:"setup",value:function(){var t=0;for(var e in f){var i=!0,n=!1,r=void 0;try{for(var s,a=(0,o["default"])(f[e]);!(i=(s=a.next()).done);i=!0){var u=s.value;this.test(u,function(e){return e===!1&&++t})}}catch(l){n=!0,r=l}finally{try{!i&&a["return"]&&a["return"]()}finally{if(n)throw r}}0>=t&&console.info("%c ✓ "+e,"color: darkgreen;")}t?console.error(t+" "+(t>1||0===t?"tests":"test")+" failed!"):console.info("%cAll tests passed successfully!","color: green;")}}]),t}());e["default"]=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.NODE_TYPES=void 0;var r=i(1),s=n(r),o=i(2),a=n(o),u=e.NODE_TYPES={Program:1,BlockStatement:2,ReturnStatement:3,Literal:4,Identifier:5,IfStatement:6,BinaryExpression:7,UnaryExpression:8,AsyncStatement:9,MemberExpression:10,CallExpression:11,AssignmentExpression:12},l=function(){function t(){(0,s["default"])(this,t)}return(0,a["default"])(t,null,[{key:"Program",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.Program,this.body=[]}}},{key:"BlockStatement",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.BlockStatement,this.body=[]}}},{key:"ReturnStatement",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.ReturnStatement,this.value=null}}},{key:"Literal",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.Literal,this.name=null,this.value=null}}},{key:"Identifier",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.Identifier,this.name=null}}},{key:"IfStatement",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.IfStatement,this.condition=null,this.consequent=null,this.alternate=null}}},{key:"BinaryExpression",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.BinaryExpression,this.operator=null,this.left=null,this.right=null}}},{key:"UnaryExpression",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.UnaryExpression,this.operator=null,this.init=null}}},{key:"AsyncStatement",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.AsyncStatement,this.init=null}}},{key:"MemberExpression",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.MemberExpression,this.object=null,this.property=null}}},{key:"CallExpression",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.CallExpression,this.callee=null,this.arguments=[]}}},{key:"AssignmentExpression",get:function(){return function t(){(0,s["default"])(this,t),this.type=u.AssignmentExpression,this.operator=null,this.left=null,this.right=null}}}]),t}();e["default"]=l},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Mathematical=[{name:"Not",expression:"!true",expect:!1},{name:"Not",expression:"!!true",expect:!0},{name:"Not",expression:"!!!false",expect:!0},{name:"Logical And",expression:"1 && 2",expect:2},{name:"Logical And",expression:"1 == 1 && 2 >= 2",expect:!0},{name:"Logical And",expression:"1 != 1 && 2 < 2",expect:!1},{name:"Logical Or",expression:"0 || 2",expect:2},{name:"Logical Or",expression:"2 || 0",expect:2},{name:"Logical Or",expression:"10 <= 2 || 5 < 2 || 50 / 2 == 25",expect:!0},{name:"Logical And Or",expression:"5 == 1 || 1 == 2 || 5 == 5",expect:!0},{name:"Equality",expression:"1 == 5",expect:!1},{name:"Equality",expression:"5 == 5",expect:!0},{name:"Inequality",expression:"1 != 5",expect:!0},{name:"Inequality",expression:"5 != 5",expect:!1},{name:"LW",expression:"5 < 10",expect:!0},{name:"LW",expression:"10 < 5",expect:!1},{name:"LW",expression:"5 < 5",expect:!1},{name:"LE",expression:"5 <= 10",expect:!0},{name:"LE",expression:"10 <= 5",expect:!1},{name:"LE",expression:"5 <= 5",expect:!0},{name:"GT",expression:"5 > 10",expect:!1},{name:"GT",expression:"10 > 5",expect:!0},{name:"GT",expression:"5 > 5",expect:!1},{name:"GE",expression:"5 >= 10",expect:!1},{name:"GE",expression:"10 >= 5",expect:!0},{name:"GE",expression:"5 >= 5",expect:!0},{name:"Add operator",expression:"5.5 + 2.5 + 7",expect:15},{name:"Minus operator",expression:"5.5 - 2.5 - 7",expect:-4},{name:"Mul operator",expression:"5.5 * 2.5 * 7",expect:96.25},{name:"Div operator",expression:"25 / 5 / 2.5",expect:2},{name:"Mod operator",expression:"32 % 6",expect:2},{name:"Complex",expression:"5 + 1 / 2 * 2 - ((2.5 * (6 + 4 * 2) / 5) * 5) - 1.5",expect:-30.5},{name:"Negative integer",expression:"-77.5",expect:-77.5},{name:"True bool",expression:"true",expect:!0},{name:"False bool",expression:"false",expect:!1}]},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=n(r),o=i(2),a=n(o),u=function(){function t(e,i){(0,s["default"])(this,t),this.TOKEN_LIST=e||{},this.IGNORE_LIST=i||[],this.buffer=null,this.index=0}return(0,a["default"])(t,[{key:"isDigit",value:function(t){return t>=48&&57>=t}},{key:"isAlpha",value:function(t){return t>64&&91>t||t>96&&123>t}},{key:"isAlphaDigit",value:function(t){return t>47&&58>t||t>64&&91>t||t>96&&123>t||95===t}},{key:"isString",value:function(t){return 34===t||39===t}},{key:"isValidToken",value:function(t){return void 0!==t.name&&this.IGNORE_LIST.indexOf(t.name)<=-1}},{key:"isIgnoredName",value:function(t){return this.IGNORE_LIST.indexOf(t)<=-1}},{key:"readNumber",value:function(){for(var t=this.index+1,e=null;t<this.length&&(e=this.buffer.charAt(t).charCodeAt(0),46===e||this.isDigit(e)!==!1);++t);var i=this.buffer.slice(this.index,t);return this.index=t,{name:"NUMBER",value:i}}},{key:"readIdentifier",value:function(){for(var t=this.index+1;t<this.length&&this.isAlphaDigit(this.buffer.charAt(t).charCodeAt(0))===!0;++t);var e=this.buffer.slice(this.index,t);return this.index=t,void 0!==this.TOKEN_LIST[e]?{name:this.TOKEN_LIST[e],value:e}:{name:"IDENTIFIER",value:e}}},{key:"readString",value:function(){var t=this.buffer.indexOf("'",this.index+1);if(-1===t&&(t=this.buffer.indexOf('"',this.index+1),-1===t))throw new Error("Unexpected quote at "+this.index+"!");var e={name:"STRING",value:this.buffer.slice(this.index,t+1)};return this.index=t+1,e}},{key:"readNegativeNumber",value:function(){var t=null;return t=this.readNumber(),t.value="-"+t.value,t}},{key:"readSign",value:function(){for(var t=null,e=0,i=null,n="";;){if(t=this.buffer.charAt(this.index),e=t.charCodeAt(0),this.isDigit(e)===!0&&"-"===n)return this.readNegativeNumber();if(n+=t,void 0===this.TOKEN_LIST[n])break;if(this.index++,i=this.TOKEN_LIST[n],this.index>this.length)break}return{name:i,value:n}}},{key:"scan",value:function(t){this.index=0,this.vIndex=0,this.buffer=t,this.length=this.buffer.length;for(var e=null,i=null,n=0,r=null,s=[];(e=this.buffer.charAt(this.index))&&!(this.index>=this.length);)n=e.charCodeAt(0),void 0!==(i=this.TOKEN_LIST[e])&&(r=this.readSign(),this.isValidToken(r)===!0&&s.push(r)),this.isDigit(n)===!0&&(r=this.readNumber(),this.isValidToken(r)===!0&&s.push(r)),this.isAlpha(n)===!0&&(r=this.readIdentifier(),this.isValidToken(r)===!0&&s.push(r)),
this.isString(n)===!0&&(r=this.readString(),this.isValidToken(r)===!0&&s.push(r));return s}}]),t}();e["default"]=u},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),o=r(s),a=i(2),u=r(a),l=i(117),h=r(l),c=i(121),f=n(c),d=i(122),p=n(d),y=i(123),v=n(y),g=i(7),m=function(){function t(){(0,o["default"])(this,t),this.tokens=null,this.index=0,this.precedence=f.precedence,Object.defineProperty(this,"node",{get:function(){return this.tokens[this.index]}})}return(0,u["default"])(t,[{key:"parse",value:function(t){this.tokens=t,this.index=0;for(var e=new h["default"].Program,i=this.tokens.length,n=null;!(this.index>=i);)null!==(n=this.parseBlock())&&e.body.push(n);return e}},{key:"next",value:function(){this.index++}},{key:"accept",value:function(t){return void 0===this.node?!1:this.node.name===t}},{key:"expect",value:function(t){for(;!0;){if(this.node.name===t){this.next();break}this.next()}}},{key:"acceptPrecedenceState",value:function(t){return void 0!==t&&void 0!==this.node&&t.indexOf(this.node.name)>-1}}]),t}();e["default"]=m,(0,g.inherit)(m,p),(0,g.inherit)(m,v)},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.precedence=[["OR"],["AND"],["EQ","NEQ"],["LE","LT","GE","GT"],["ADD","SUB"],["MUL","DIV","MOD"]]},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(){return this.accept("IF")===!0?this.parseIfStatement():this.accept("RETURN")===!0?this.parseReturnStatement():this.accept("ATSIGN")===!0?this.parseAsyncStatement():this.accept("IDENTIFIER")===!0?this.parseIdentifierRoute():this.parseExpression(0)}function s(){var t=null;return this.next(),t=new g["default"].AsyncStatement,t.init=this.parseBlock(),t}function o(){return this.accept("ASSIGN")===!0||this.accept("ADDSET")===!0||this.accept("SUBSET")===!0||this.accept("MULSET")===!0||this.accept("DIVSET")===!0||this.accept("MODSET")===!0}function a(){var t=null,e=this.parseExpression(0);return this.accept("LPAREN")===!0&&(t=this.parseCallExpression(),t.callee=e),this.isSet()===!0&&(t=this.parseAssignmentExpression(),t.left=e),null===t?e:t}function u(){var t=null;return t=new g["default"].CallExpression,t.arguments=this.parseArguments(),this.next(),t}function l(){var t=null;return t=new g["default"].AssignmentExpression,t.left=this.parseExpression(0),t.operator=this.node.name,this.next(),t.right=this.parseExpression(0),this.accept("SEMICOLON")===!0&&this.next(),t}function h(){var t=null;return this.next(),t=new g["default"].IfStatement,t.condition=this.parseParentheseExpression(),t.consequent=this.parseBraceBody(),this.accept("LBRACE")===!0&&(t.alternate=this.parseBraceBody()),t}function c(){var t=null;return this.next(),t=new g["default"].ReturnStatement,t.value=this.parseParentheseExpression(),this.next(),t}function f(){var t=null;return this.expect("LBRACE"),t=this.parseBlockStatement(),this.expect("RBRACE"),t}function d(){for(var t=new g["default"].BlockStatement;!0&&this.accept("RBRACE")!==!0;)t.body.push(this.parseBlock());return t}function p(){var t=[],e=null;for(this.expect("LPAREN"),e=this.parseBlock(),null!==e&&t.push(e);this.accept("COMMA")===!0;)if(this.next(),this.accept("LPAREN")===!0?(this.next(),e=this.parseCallExpression(),null!==e&&t.push(e)):(e=this.parseBlock(),null!==e&&t.push(e)),this.accept("RPAREN")===!0){this.next();break}return t.length<=1&&this.accept("RPAREN")===!0&&this.next(),t}function f(){var t=null;return this.expect("LBRACE"),t=this.parseBlockStatement(),this.expect("RBRACE"),t}function y(){var t=null;return this.expect("LPAREN"),t=this.parseExpression(0),this.expect("RPAREN"),t}Object.defineProperty(e,"__esModule",{value:!0}),e.parseBlock=r,e.parseAsyncStatement=s,e.isSet=o,e.parseIdentifierRoute=a,e.parseCallExpression=u,e.parseAssignmentExpression=l,e.parseIfStatement=h,e.parseReturnStatement=c,e.parseBraceBody=f,e.parseBlockStatement=d,e.parseArguments=p,e.parseBraceBody=f,e.parseParentheseExpression=y;var v=i(117),g=n(v)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(){var t=null,e=null,i=null;for(t=this.parseUnary();this.accept("PERIOD")===!0;)i=new l["default"].MemberExpression,i.object=t,this.next(),e=this.parseMemberExpression(),i.property=e,t=i;return t}function s(t){var e=null,i=null,n=null,r=null;for(e=this.precedence[t],i=void 0===e?this.parseUnary():this.parseExpression(t+1);this.acceptPrecedenceState(e)===!0;){if(n=new l["default"].BinaryExpression,n.operator=this.node.name,n.left=i,this.next(),r=void 0===e?this.parseUnary():this.parseExpression(t+1),null===r)return null;n.right=r,i=n,this.accept("SEMICOLON")===!0&&this.next()}return i}function o(){var t=null,e=null;if(this.accept("SUB")===!0){if(t=new l["default"].BinaryExpression,t.operator=this.node.name,e=new l["default"].Literal,e.name="NUMBER",e.value=0,t.right=e,this.next(),null===(e=this.parseBase()))return null;t.left=e}else if(this.accept("NOT")===!0)t=new l["default"].UnaryExpression,t.operator=this.node.name,this.next(),t.init=this.parseExpression(0);else if(this.accept("ADD")===!0&&this.next(),!(t=this.parseBase()))return null;return t}function a(){var t=null;if(this.accept("TRUE")===!0||this.accept("FALSE")===!0)return t=new l["default"].Identifier,t.name=this.node.value,this.next(),t;if(this.accept("NUMBER")===!0)return t=new l["default"].Literal,t.name=this.node.name,t.value=Number(this.node.value),this.next(),t;if(this.accept("STRING")===!0)return t=new l["default"].Literal,t.name=this.node.name,t.value=this.node.value,this.next(),t;if(this.accept("LPAREN")===!0)return this.next(),t=this.parseExpression(0),this.next(),t;if(this.accept("IDENTIFIER")===!0){if(t=new l["default"].Identifier,t.name=this.node.value,"PERIOD"===this.tokens[this.index+1].name){this.next();var e=this.parseMemberExpression();return e.object=t,e}return this.next(),t}return t}Object.defineProperty(e,"__esModule",{value:!0}),e.parseMemberExpression=r,e.parseExpression=s,e.parseUnary=o,e.parseBase=a;var u=i(117),l=n(u)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=n(r),o=i(2),a=n(o),u=i(117),l=(i(7),function(){function t(e){(0,s["default"])(this,t),this.instance=e,this.context={FLAGS:this.instance.FLAGS,"this":null,trigger:null,console:window.console,alert:window.alert,kernel:this.instance.instance}}return(0,a["default"])(t,[{key:"setGlobalScope",value:function(t){this.context["this"]=t}},{key:"setTriggerScope",value:function(t){this.context.trigger=t}},{key:"isLiteral",value:function(t){return t.type===u.NODE_TYPES.Literal}},{key:"isIdentifier",value:function(t){return t.type===u.NODE_TYPES.Identifier}},{key:"isBoolean",value:function(t){return"true"===t.name||"false"===t.name}},{key:"isIfStatement",value:function(t){return t.type===u.NODE_TYPES.IfStatement}},{key:"isAssignmentExpression",value:function(t){return t.type===u.NODE_TYPES.AssignmentExpression}},{key:"isMemberExpression",value:function(t){return t.type===u.NODE_TYPES.MemberExpression}},{key:"isCallExpression",value:function(t){return t.type===u.NODE_TYPES.CallExpression}},{key:"isAsyncStatement",value:function(t){return t.type===u.NODE_TYPES.AsyncStatement}},{key:"isBinaryExpression",value:function(t){return t.type===u.NODE_TYPES.BinaryExpression||t.type===u.NODE_TYPES.UnaryExpression||this.isLiteral(t)===!0||this.isIdentifier(t)===!0||this.isMemberExpression(t)===!0}},{key:"evaluate",value:function(t,e){this.evaluateBody(t,0,function(t){return e(t)})}},{key:"evaluateBody",value:function(t,e,i){this.evalStatement(t.body[e],function(n){++e<t.body.length?this.evaluateBody(t,e,function(t){return i(t)}):i(n)}.bind(this))}},{key:"evalStatement",value:function(t,e){if(this.isBinaryExpression(t)===!0)return e(this.evalBinaryExpression(t));if(this.isIfStatement(t)===!0){if(null===t.condition)throw new Error("Invalid if statement condition");return this.evalExpression(t.condition).value===!0?this.evaluateBody(t.consequent,0,function(t){return e(t)}):null!==t.alternate?this.evaluateBody(t.alternate,0,function(t){return e(t)}):e()}return this.isAssignmentExpression(t)===!0?e(this.evalAssignExpression(t)):this.isCallExpression(t)===!0?(this.evalCallExpression(t),e()):this.isAsyncStatement(t)===!0?this.evalCallExpression(t.init,function(t){return e(t)}):e()}},{key:"evalAssignExpression",value:function(t){var e=null,i=this.evalExpression(t.left),n=this.evalExpression(t.right);return e=void 0!==n.link?n.link[n.property]:n.value,"ASSIGN"===t.operator?i.link[i.property]=e:"ADDSET"===t.operator?i.link[i.property]+=e:"SUBSET"===t.operator?i.link[i.property]-=e:"MULSET"===t.operator?i.link[i.property]*=e:"DIVSET"===t.operator?i.link[i.property]/=e:"MODSET"===t.operator?i.link[i.property]%=e:0}},{key:"evalCallExpression",value:function(t,e){var i=this.evalExpression(t.callee),n=null;n=void 0===i.link?this.context[t.callee.name]:i.link[i.property],this.evalArguments(t.arguments,function(t){t.length>=1?n.apply(i.link,t):n.bind(i.link)(function(t){return e(t)})})}},{key:"evalArguments",value:function(t,e){var i=[],n=0,r=t.length,s=0;if(!(r>=1))return e(i);for(;r>n;++n)this.evalStatement(t[n],function(t){return s++,i.push(t),s>=r?e(i):void 0})}},{key:"evalExpression",value:function(t){return this.isMemberExpression(t)===!0?this.evalMemberExpression(this.context,t):{value:this.evalBinaryExpression(t)}}},{key:"evalMemberExpression",value:function(t,e){var i=null;if(this.isLiteral(e)===!0)return{value:this.evalBinaryExpression(e)};if(this.isIdentifier(e)===!0)return t[e.name];if(this.isIdentifier(e.object)===!0&&(i=t=t[e.object.name]),void 0===t)throw new Error(e.object.name+" => "+e.property.name+" does not exist!");return this.isIdentifier(e.property)===!0&&(t=t[e.property.name]),this.isMemberExpression(e.property)===!0?this.evalMemberExpression(i,e.property):{link:i,property:e.property.name}}},{key:"evalBinaryExpression",value:function(t){if(this.isLiteral(t)===!0)return t.value;if(this.isIdentifier(t)===!0&&this.isBoolean(t)===!0)return"true"===t.name;if(this.isMemberExpression(t)===!0){var e=this.evalMemberExpression(this.context,t);return e.link[e.property]}return"EQ"===t.operator?this.evalBinaryExpression(t.left)===this.evalBinaryExpression(t.right):"NEQ"===t.operator?this.evalBinaryExpression(t.left)!==this.evalBinaryExpression(t.right):"LT"===t.operator?this.evalBinaryExpression(t.left)<this.evalBinaryExpression(t.right):"LE"===t.operator?this.evalBinaryExpression(t.left)<=this.evalBinaryExpression(t.right):"GT"===t.operator?this.evalBinaryExpression(t.left)>this.evalBinaryExpression(t.right):"GE"===t.operator?this.evalBinaryExpression(t.left)>=this.evalBinaryExpression(t.right):"ADD"===t.operator?this.evalBinaryExpression(t.left)+this.evalBinaryExpression(t.right):"SUB"===t.operator?this.evalBinaryExpression(t.left)-this.evalBinaryExpression(t.right):"MUL"===t.operator?this.evalBinaryExpression(t.left)*this.evalBinaryExpression(t.right):"DIV"===t.operator?this.evalBinaryExpression(t.left)/this.evalBinaryExpression(t.right):"MOD"===t.operator?this.evalBinaryExpression(t.left)%this.evalBinaryExpression(t.right):"AND"===t.operator?this.evalBinaryExpression(t.left)&&this.evalBinaryExpression(t.right):"OR"===t.operator?this.evalBinaryExpression(t.left)||this.evalBinaryExpression(t.right):"NOT"===t.operator?!this.evalBinaryExpression(t.init):this.isIdentifier(t)===!0?this.context[t.name]:0}}]),t}());e["default"]=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(65),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=i(70),c=n(h),f=i(79),d=n(f),p=i(6),y=i(85),v=(n(y),i(7)),g=i(90),m=n(g),E=i(96),x=n(E),_=function(t){function e(t,i){(0,a["default"])(this,e);var n=(0,c["default"])(this,(0,s["default"])(e).call(this,i));return n.instance=t,n.follow=i.follow||null,n.hasShadow=!1,n.type=p.TYPES.Notification,n.style=i.style||"MapMessage",n.msg=i.msg||"undefined",n.topLeft="assets/img/chat/tleft.png",n.topRight="assets/img/chat/tright.png",n.bottomLeft="assets/img/chat/bleft.png",n.bottomRight="assets/img/chat/bright.png",n.pointer="assets/img/chat/point.png",n.fill="assets/img/chat/fill.png",n.texture=null,n.padding=3,n.zIndex=9999,n.z=0,n.absolute=i.absolute||!1,n.maxLifeTime=3e3+Date.now(),n.lifeTime=Date.now()+60*(4*n.msg.length),null!==n.follow&&(n.position=n.follow.position),i.fade===!0?(n.opacity=0,n.fadeIn(2)):n.opacity=1,i.sound===!0&&n.playSound(),n.lifeTime>n.maxLifeTime&&(n.lifeTime=n.maxLifeTime),n.loadTexture(),n}return(0,d["default"])(e,t),(0,l["default"])(e,[{key:"getFrameIndex",value:function(){return 0}},{key:"playSound",value:function(){if(p.BGS!==!1){var t=this.instance.currentMap.distance(this.follow,this.instance.camera);m["default"].playSound("notice",75,t.x,t.y)}}},{key:"loadTexture",value:function(){function t(t,e){(0,v.getSprite)(i[t],i.width,i.height,function(i){this[t]=i,e()}.bind(i))}var e=this,i=this;t("topLeft",function(){return t("topRight",function(){return t("bottomLeft",function(){return t("bottomRight",function(){return t("pointer",function(){return t("fill",function(){this.draw()}.bind(e))})})})})})}},{key:"draw",value:function(){"ChatBubble"===this.style?this.drawChatBubble():"MapMessage"===this.style?this.drawMapMessage():"MessageBox"===this.style&&this.drawMessageBox()}},{key:"drawMapMessage",value:function(){this.position={x:p.DIMENSION,y:p.DIMENSION};var t=this.size.y;this.size=this.instance.size,this.size.y=7.5*t,this.size.x=2*this.instance.width-10*this.padding,this.z=0,this.texture=(0,v.createCanvasBuffer)(this.width,this.height+this.pointer.height);var e=this.texture;this.drawBox(e,this.width,this.height,this.padding),this.drawText(e,this.width,this.height,this.msg,1.5)}},{key:"drawChatBubble",value:function(){this.texture=(0,v.createCanvasBuffer)(this.width,this.height+this.pointer.height);var t=this.texture;this.drawBox(t,this.width,this.height,this.padding),t.drawImage(this.pointer.texture.canvas,this.width/2,this.height),this.drawText(t,this.width,this.height+this.pointer.height,this.msg,.75)}},{key:"drawBox",value:function(t,e,i,n){t.drawImage(this.fill.texture.canvas,n,n,e-2*n,i-2*n),t.drawImage(this.fill.texture.canvas,0,n,n,i-2*n),t.drawImage(this.fill.texture.canvas,e-n,n,n,i-2*n),t.drawImage(this.fill.texture.canvas,n,0,e-2*n,n),t.drawImage(this.fill.texture.canvas,n,i-n,e-2*n,n),t.drawImage(this.topLeft.texture.canvas,0,0),t.drawImage(this.topRight.texture.canvas,e-this.topRight.width,0),t.drawImage(this.bottomLeft.texture.canvas,0,i-this.bottomLeft.height),t.drawImage(this.bottomRight.texture.canvas,e-this.topRight.width,i-this.bottomLeft.height)}},{key:"drawText",value:function(t,e,i,n,r){var s=(0,v.createCanvasBuffer)(e,i);s.font="25px AdvoCut",s.strokeStyle="#000",s.lineWidth=2.75,s.strokeText(n,e/4,i),s.fillStyle="white",s.fillText(n,e/4,i),t.drawImage(s.canvas,0,0,e*r<<0,i*r<<0)}}]),e}(x["default"]);e["default"]=_},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),o=r(s),a=i(2),u=r(a);i(127);var l=i(85),h=(r(l),i(6)),c=n(h),f=i(7),d=i(105),p=n(d),y=i(132),v=n(y),g=i(134),m=n(g),E=i(138),x=r(E),_=function(){function t(e){(0,o["default"])(this,t),this.instance=e,this.glRenderer=null,this.size=e.size,this.layers=e.layers,this.node=e.node,this.glNode=e.glNode,this.uiNode=e.uiNode,this.context=e.context,this.gl=e.glContext,this.imageSmoothing=!1,this.dimension=c.DIMENSION,this.delta=0,this.now=0,this.then=0,this.width=0,this.height=0,this.camera=e.camera,c.WGL_SUPPORT&&(this.glRenderer=new x["default"](this),this.glRenderer.init()),this.switchRenderingMode(c.DEBUG_MODE?0:1),this.resize(!1)}return(0,u["default"])(t,[{key:"switchRenderingMode",value:function(t){t===c.WGL&&(c.WGL_SUPPORT?(this.node.style.display="none",this.glNode.style.display="block",c.RENDER_MODE=t):t=c.CANVAS),t===c.CANVAS&&(this.node.style.display="block",this.glNode.style.display="none",c.RENDER_MODE=t)}},{key:"update",value:function(){this.updateTimers(),null!==this.camera.objectFocus&&this.camera.animate(this.camera.objectFocus)}},{key:"updateTimers",value:function(){this.now=Date.now(),this.delta=(this.now-this.then)/1e3,this.then=this.now}},{key:"resize",value:function(){this.width=window.innerWidth,this.height=window.innerHeight,this.camera.width=this.width,this.camera.height=this.height,this.instance.width=this.width,this.instance.height=this.height,this.uiNode.width=this.width,this.uiNode.height=this.height,this.instance.resizeScenes(),c.RENDER_MODE===c.WGL?(this.glNode.width=this.width,this.glNode.height=this.height,this.glRenderer.resize(this.width,this.height)):(this.node.width=this.width,this.node.height=this.height),this.clear(),this.instance.mini.resize(),this.draw()}},{key:"imageSmoothingEnabled",set:function(t){t=!!t,this.imageSmoothing=t,this.context.setImageSmoothing(t)}}]),t}();e["default"]=_,(0,f.inherit)(_,m),(0,f.inherit)(_,v),(0,f.inherit)(_,p),(0,f.inherit)(_,webgl)},function(t,e,i){"use strict";i(128);window.rAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}(),CanvasRenderingContext2D.prototype.setImageSmoothing=function(t){this.imageSmoothingEnabled=t,this.oImageSmoothingEnabled=t,this.msImageSmoothingEnabled=t,this.mozImageSmoothingEnabled=t,this.webkitImageSmoothingEnabled=t},CanvasRenderingContext2D.prototype.clear=function(t){if(t){var e=this.fillStyle;this.fillStyle=t,this.fillRect(0,0,this.canvas.width,this.canvas.height),this.fillStyle=e}else this.clearRect(0,0,this.canvas.width,this.canvas.height)},function(t,e){function i(e,i,o,a){e[n](s+i,"wheel"==r?o:function(e){!e&&(e=t.event);var i={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==e.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=!1}};return"mousewheel"==r?(i.deltaY=-1/40*e.wheelDelta,e.wheelDeltaX&&(i.deltaX=-1/40*e.wheelDeltaX)):i.deltaY=e.detail,o(i)},a||!1)}var n,r,s="";t.addEventListener?n="addEventListener":(n="attachEvent",s="on"),r="onwheel"in e.createElement("div")?"wheel":void 0!==e.onmousewheel?"mousewheel":"DOMMouseScroll",t.addWheelListener=function(t,e,n){i(t,r,e,n),"DOMMouseScroll"==r&&i(t,"MozMousePixelScroll",e,n)}}(window,document)},function(t,e,i){function n(t){return t&&t.__esModule?t:{"default":t}}var r,s=i(71),o=n(s),a=i(129),u=n(a);!function(){var n={},s=null,a=!0,l=!1;try{"undefined"!=typeof AudioContext?s=new AudioContext:"undefined"!=typeof webkitAudioContext?s=new webkitAudioContext:a=!1}catch(h){a=!1}if(!a)if("undefined"!=typeof Audio)try{new Audio}catch(h){l=!0}else l=!0;if(a){var c="undefined"==typeof s.createGain?s.createGainNode():s.createGain();c.gain.value=1,c.connect(s.destination)}var f=function(t){this._volume=1,this._muted=!1,this.usingWebAudio=a,this.ctx=s,this.noAudio=l,this._howls=[],this._codecs=t,this.iOSAutoEnable=!0};f.prototype={volume:function(t){var e=this;if(t=parseFloat(t),t>=0&&1>=t){e._volume=t,a&&(c.gain.value=t);for(var i in e._howls)if(e._howls.hasOwnProperty(i)&&e._howls[i]._webAudio===!1)for(var n=0;n<e._howls[i]._audioNode.length;n++)e._howls[i]._audioNode[n].volume=e._howls[i]._volume*e._volume;return e}return a?c.gain.value:e._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(t){var e=this;e._muted=t,a&&(c.gain.value=t?0:e._volume);for(var i in e._howls)if(e._howls.hasOwnProperty(i)&&e._howls[i]._webAudio===!1)for(var n=0;n<e._howls[i]._audioNode.length;n++)e._howls[i]._audioNode[n].muted=t},codecs:function(t){return this._codecs[t]},_enableiOSAudio:function(){var t=this;if(!s||!t._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){t._iOSEnabled=!1;var e=function i(){var e=s.createBuffer(1,1,22050),n=s.createBufferSource();n.buffer=e,n.connect(s.destination),"undefined"==typeof n.start?n.noteOn(0):n.start(0),setTimeout(function(){n.playbackState!==n.PLAYING_STATE&&n.playbackState!==n.FINISHED_STATE||(t._iOSEnabled=!0,t.iOSAutoEnable=!1,window.removeEventListener("touchend",i,!1))},0)};return window.addEventListener("touchend",e,!1),t}}};var d=null,p={};l||(d=new Audio,p={mp3:!!d.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!d.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var y=new f(p),v=function(t){var e=this;e._autoplay=t.autoplay||!1,e._buffer=t.buffer||!1,e._duration=t.duration||0,e._format=t.format||null,e._loop=t.loop||!1,e._loaded=!1,e._sprite=t.sprite||{},e._src=t.src||"",e._pos3d=t.pos3d||[0,0,-.5],e._volume=void 0!==t.volume?t.volume:1,e._urls=t.urls||[],e._rate=t.rate||1,e._model=t.model||null,e._onload=[t.onload||function(){}],e._onloaderror=[t.onloaderror||function(){}],e._onend=[t.onend||function(){}],e._onpause=[t.onpause||function(){}],e._onplay=[t.onplay||function(){}],e._onendTimer=[],e._webAudio=a&&!e._buffer,e._audioNode=[],e._webAudio&&e._setupAudioNode(),"undefined"!=typeof s&&s&&y.iOSAutoEnable&&y._enableiOSAudio(),y._howls.push(e),e.load()};if(v.prototype={load:function(){var t=this,e=null;if(l)return void t.on("loaderror",new Error("No audio support."));for(var i=0;i<t._urls.length;i++){var n,r;if(t._format)n=t._format;else{if(r=t._urls[i],n=/^data:audio\/([^;,]+);/i.exec(r),n||(n=/\.([^.]+)$/.exec(r.split("?",1)[0])),!n)return void t.on("loaderror",new Error("Could not extract format from passed URLs, please add format parameter."));n=n[1].toLowerCase()}if(p[n]){e=t._urls[i];break}}if(!e)return void t.on("loaderror",new Error("No codec support for selected audio sources."));if(t._src=e,t._webAudio)g(t,e);else{var s=new Audio;s.addEventListener("error",function(){s.error&&4===s.error.code&&(f.noAudio=!0),t.on("loaderror",{type:s.error?s.error.code:0})},!1),t._audioNode.push(s),s.src=e,s._pos=0,s.preload="auto",s.volume=y._muted?0:t._volume*y.volume();var o=function a(){t._duration=Math.ceil(10*s.duration)/10,0===(0,u["default"])(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play(),s.removeEventListener("canplaythrough",a,!1)};s.addEventListener("canplaythrough",o,!1),s.load()}return t},urls:function(t){var e=this;return t?(e.stop(),e._urls="string"==typeof t?[t]:t,e._loaded=!1,e.load(),e):e._urls},play:function(t,e){var i=this;return"function"==typeof t&&(e=t),t&&"function"!=typeof t||(t="_default"),i._loaded?i._sprite[t]?(i._inactiveNode(function(n){n._sprite=t;var r=n._pos>0?n._pos:i._sprite[t][0]/1e3,o=0;i._webAudio?(o=i._sprite[t][1]/1e3-n._pos,n._pos>0&&(r=i._sprite[t][0]/1e3+r)):o=i._sprite[t][1]/1e3-(r-i._sprite[t][0]/1e3);var a,u=!(!i._loop&&!i._sprite[t][2]),l="string"==typeof e?e:Math.round(Date.now()*Math.random())+"";if(function(){var e={id:l,sprite:t,loop:u};a=setTimeout(function(){!i._webAudio&&u&&i.stop(e.id).play(t,e.id),i._webAudio&&!u&&(i._nodeById(e.id).paused=!0,i._nodeById(e.id)._pos=0,i._clearEndTimer(e.id)),i._webAudio||u||i.stop(e.id),i.on("end",l)},o/i._rate*1e3),i._onendTimer.push({timer:a,id:e.id})}(),i._webAudio){var h=i._sprite[t][0]/1e3,c=i._sprite[t][1]/1e3;n.id=l,n.paused=!1,x(i,[u,h,c],l),i._playStart=s.currentTime,n.gain.value=i._volume,"undefined"==typeof n.bufferSource.start?u?n.bufferSource.noteGrainOn(0,r,86400):n.bufferSource.noteGrainOn(0,r,o):u?n.bufferSource.start(0,r,86400):n.bufferSource.start(0,r,o)}else{if(4!==n.readyState&&(n.readyState||!navigator.isCocoonJS))return i._clearEndTimer(l),function(){var r=i,s=t,o=e,a=n,u=function l(){r.play(s,o),a.removeEventListener("canplaythrough",l,!1)};a.addEventListener("canplaythrough",u,!1)}(),i;n.readyState=4,n.id=l,n.currentTime=r,n.muted=y._muted||n.muted,n.volume=i._volume*y.volume(),setTimeout(function(){n.play()},0)}return i.on("play"),"function"==typeof e&&e(l),i}),i):("function"==typeof e&&e(),i):(i.on("load",function(){i.play(t,e)}),i)},pause:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.pause(t)}),e;e._clearEndTimer(t);var i=t?e._nodeById(t):e._activeNode();if(i)if(i._pos=e.pos(null,t),e._webAudio){if(!i.bufferSource||i.paused)return e;i.paused=!0,"undefined"==typeof i.bufferSource.stop?i.bufferSource.noteOff(0):i.bufferSource.stop(0)}else i.pause();return e.on("pause"),e},stop:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.stop(t)}),e;e._clearEndTimer(t);var i=t?e._nodeById(t):e._activeNode();if(i)if(i._pos=0,e._webAudio){if(!i.bufferSource||i.paused)return e;i.paused=!0,"undefined"==typeof i.bufferSource.stop?i.bufferSource.noteOff(0):i.bufferSource.stop(0)}else isNaN(i.duration)||(i.pause(),i.currentTime=0);return e},mute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.mute(t)}),e;var i=t?e._nodeById(t):e._activeNode();return i&&(e._webAudio?i.gain.value=0:i.muted=!0),e},unmute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.unmute(t)}),e;var i=t?e._nodeById(t):e._activeNode();return i&&(e._webAudio?i.gain.value=e._volume:i.muted=!1),e},volume:function(t,e){var i=this;if(t=parseFloat(t),t>=0&&1>=t){if(i._volume=t,!i._loaded)return i.on("play",function(){i.volume(t,e)}),i;var n=e?i._nodeById(e):i._activeNode();return n&&(i._webAudio?n.gain.value=t:n.volume=t*y.volume()),i}return i._volume},loop:function(t){var e=this;return"boolean"==typeof t?(e._loop=t,e):e._loop},sprite:function(t){var e=this;return"object"===("undefined"==typeof t?"undefined":(0,o["default"])(t))?(e._sprite=t,e):e._sprite},pos:function(t,e){var i=this;if(!i._loaded)return i.on("load",function(){i.pos(t)}),"number"==typeof t?i:i._pos||0;t=parseFloat(t);var n=e?i._nodeById(e):i._activeNode();if(n)return t>=0?(i.pause(e),n._pos=t,i.play(n._sprite,e),i):i._webAudio?n._pos+(s.currentTime-i._playStart):n.currentTime;if(t>=0)return i;for(var r=0;r<i._audioNode.length;r++)if(i._audioNode[r].paused&&4===i._audioNode[r].readyState)return i._webAudio?i._audioNode[r]._pos:i._audioNode[r].currentTime},pos3d:function(t,e,i,n){var r=this;if(e="undefined"!=typeof e&&e?e:0,i="undefined"!=typeof i&&i?i:-.5,!r._loaded)return r.on("play",function(){r.pos3d(t,e,i,n)}),r;if(!(t>=0||0>t))return r._pos3d;if(r._webAudio){var s=n?r._nodeById(n):r._activeNode();s&&(r._pos3d=[t,e,i],s.panner.setPosition(t,e,i),s.panner.panningModel=r._model||"HRTF")}return r},fade:function(t,e,i,n,r){var s=this,o=Math.abs(t-e),a=t>e?"down":"up",u=o/.01,l=i/u;if(!s._loaded)return s.on("load",function(){s.fade(t,e,i,n,r)}),s;s.volume(t,r);for(var h=1;u>=h;h++)!function(){var t=s._volume+("up"===a?.01:-.01)*h,i=Math.round(1e3*t)/1e3,o=e;setTimeout(function(){s.volume(i,r),i===o&&n&&n()},l*h)}()},fadeIn:function(t,e,i){return this.volume(0).play().fade(0,t,e,i)},fadeOut:function(t,e,i,n){var r=this;return r.fade(r._volume,t,e,function(){i&&i(),r.pause(n),r.on("end")},n)},_nodeById:function(t){for(var e=this,i=e._audioNode[0],n=0;n<e._audioNode.length;n++)if(e._audioNode[n].id===t){i=e._audioNode[n];break}return i},_activeNode:function(){for(var t=this,e=null,i=0;i<t._audioNode.length;i++)if(!t._audioNode[i].paused){e=t._audioNode[i];break}return t._drainPool(),e},_inactiveNode:function(t){for(var e=this,i=null,n=0;n<e._audioNode.length;n++)if(e._audioNode[n].paused&&4===e._audioNode[n].readyState){t(e._audioNode[n]),i=!0;break}if(e._drainPool(),!i){var r;if(e._webAudio)r=e._setupAudioNode(),t(r);else{e.load(),r=e._audioNode[e._audioNode.length-1];var s=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",o=function a(){r.removeEventListener(s,a,!1),t(r)};r.addEventListener(s,o,!1)}}},_drainPool:function(){var t,e=this,i=0;for(t=0;t<e._audioNode.length;t++)e._audioNode[t].paused&&i++;for(t=e._audioNode.length-1;t>=0&&!(5>=i);t--)e._audioNode[t].paused&&(e._webAudio&&e._audioNode[t].disconnect(0),i--,e._audioNode.splice(t,1))},_clearEndTimer:function(t){for(var e=this,i=-1,n=0;n<e._onendTimer.length;n++)if(e._onendTimer[n].id===t){i=n;break}var r=e._onendTimer[i];r&&(clearTimeout(r.timer),e._onendTimer.splice(i,1))},_setupAudioNode:function(){var t=this,e=t._audioNode,i=t._audioNode.length;return e[i]="undefined"==typeof s.createGain?s.createGainNode():s.createGain(),e[i].gain.value=t._volume,e[i].paused=!0,e[i]._pos=0,e[i].readyState=4,e[i].connect(c),e[i].panner=s.createPanner(),e[i].panner.panningModel=t._model||"equalpower",e[i].panner.setPosition(t._pos3d[0],t._pos3d[1],t._pos3d[2]),e[i].panner.connect(e[i]),e[i]},on:function(t,e){var i=this,n=i["_on"+t];if("function"==typeof e)n.push(e);else for(var r=0;r<n.length;r++)e?n[r].call(i,e):n[r].call(i);return i},off:function(t,e){var i=this,n=i["_on"+t];if(e){for(var r=0;r<n.length;r++)if(e===n[r]){n.splice(r,1);break}}else i["_on"+t]=[];return i},unload:function(){for(var t=this,e=t._audioNode,i=0;i<t._audioNode.length;i++)e[i].paused||(t.stop(e[i].id),t.on("end",e[i].id)),t._webAudio?e[i].disconnect(0):e[i].src="";for(i=0;i<t._onendTimer.length;i++)clearTimeout(t._onendTimer[i].timer);var r=y._howls.indexOf(t);null!==r&&r>=0&&y._howls.splice(r,1),delete n[t._src],t=null}},a)var g=function(t,e){if(e in n)return t._duration=n[e].duration,void E(t);if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),r=new Uint8Array(i.length),s=0;s<i.length;++s)r[s]=i.charCodeAt(s);m(r.buffer,t,e)}else{var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){m(o.response,t,e)},o.onerror=function(){t._webAudio&&(t._buffer=!0,t._webAudio=!1,t._audioNode=[],delete t._gainNode,delete n[e],t.load())};try{o.send()}catch(a){o.onerror()}}},m=function(t,e,i){s.decodeAudioData(t,function(t){t&&(n[i]=t,E(e,t))},function(t){e.on("loaderror",t)})},E=function(t,e){t._duration=e?e.duration:t._duration,0===(0,u["default"])(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play()},x=function(t,e,i){var r=t._nodeById(i);r.bufferSource=s.createBufferSource(),r.bufferSource.buffer=n[t._src],r.bufferSource.connect(r.panner),r.bufferSource.loop=e[0],e[0]&&(r.bufferSource.loopStart=e[1],r.bufferSource.loopEnd=e[1]+e[2]),r.bufferSource.playbackRate.value=t._rate};r=function(){return{Howler:y,Howl:v}}.call(e,i,e,t),!(void 0!==r&&(t.exports=r)),e.Howler=y,e.Howl=v,"undefined"!=typeof window&&(window.Howler=y,window.Howl=v)}()},function(t,e,i){t.exports={"default":i(130),__esModule:!0}},function(t,e,i){var n=i(5);i(131),t.exports=function(t){return n.getNames(t)}},function(t,e,i){i(69)("getOwnPropertyNames",function(){return i(76).get})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(){var t=this;return this.clear(),this.instance.sort(),this.update(),this.instance.logic(),this.draw(),y.DEBUG_MODE===!0?void(60===y.DEBUG_FPS?window.rAF(function(){return t.render()}):setTimeout(function(){return t.render()},1e3/y.DEBUG_FPS)):void window.rAF(function(){return t.render()})}function s(){y.RENDER_MODE===y.CANVAS&&(this.node.width=this.node.width,this.context.setImageSmoothing(this.imageSmoothing)),y.RENDER_MODE===y.WGL&&this.glRenderer.clear()}function o(){var t=y.RENDER_MODE===y.WGL;return t!==!1?void(this.glRenderer.ready===!0&&this.glRenderer.draw()):(this.renderEntities(1),
this.renderMap(),this.renderEntities(0),y.DEBUG_MODE===!0&&((0,g.drawGrid)(this.context,this.camera.position.x,this.camera.position.y,this.width,this.height,this.dimension,this.camera.resolution*y.GRID_WIDTH,.05,"#FFF"),y.EDIT_MODE===!0&&this.instance.editor.renderEditorMode(),this.renderDebugScene()),void(y.MINI_MAP===!0&&this.instance.mini.redraw===!0&&(this.instance.mini.draw(0,this.instance.currentMap.entities),this.context.drawImage(this.instance.mini.bgBuffer.canvas,this.instance.mini.position.x,this.instance.mini.position.y,this.instance.mini.width,this.instance.mini.height))))}function a(){var t=this.instance.currentMap,e=y.DIMENSION;this.context.drawImage(t.mainBuffer.canvas,0,0,t.size.x*e,t.size.y*e,this.camera.position.x<<0,this.camera.position.y<<0,t.size.x*e/2*this.camera.resolution<<0,t.size.y*e/2*this.camera.resolution<<0)}function u(t){var e=0,i=0,n=this.instance.editor.selectedEntities;for(i=n.length;i>e;++e)if(n[e]===t)return!0;return!1}function l(t){var e=Math.floor((this.now-t.animationStart)/t.animationSpeed);return t.loop===!1&&t.sFrame+1>=t.animationFrames?3*(2*t.size.x)<<0:e%t.animationFrames*(2*t.size.x)<<0}function h(t){t.animation===!0?t.sFrame=this.getAnimationFrame(t)/(2*t.size.x):t.sFrame=(t.frames[t.frame]+t.getFrameIndex())*(t.size.x/t.scale*2)/(2*t.size.x)+t.facing*t.texture.yMul}function c(t){for(var e=null,i=this.instance.currentMap.entities,n=this.camera.resolution,r=this.camera.position.x,s=this.camera.position.y,o=0,a=i.length,u=0;a>o;++o)e=i[o],0===t&&e.zIndex<=0||(u=e.scale+-e.position.z/n/((e.size.x+e.size.y)/2),e.renderable!==!1&&(this.updateEntitySpriteFrame(e),this.renderEntity(e,r+(e.position.x+e.xMargin+e.position.z/(e.size.x/2)/2)*n<<0,s+(e.position.y+e.yMargin+e.position.z)*n<<0,e.size.x*n*u<<0,e.size.y*n*u<<0,e.size.x/u*2*u<<0,e.size.y/u*2*u<<0)))}function f(t,e,i,n,r,s,o){var a=this.camera.resolution,u=t.customOpacity();if(u===!0&&(this.context.globalAlpha=t.opacity),y.DISPLAY_SHADOWS===!0&&t.hasShadow===!0&&this.renderShadow(t,e,i,n,r,s,o),y.EDIT_MODE===!0&&this.entityInSelectionRange(t.id)&&(this.context.globalAlpha=.75,this.context.globalCompositeOperation="screen"),t.type===y.TYPES.Notification){var l=(Math.max(t.follow.size.x,t.size.x/2)/2-t.follow.size.x/2-t.follow.xMargin-(t.size.x===t.follow.size.x?y.DIMENSION:0))*a;this.context.drawImage(t.texture.canvas,0,0,s,o,t.absolute===!0?t.position.x:e-l,t.absolute===!0?t.position.y:i-t.size.y*a,t.absolute===!0?n/a:n,t.absolute===!0?r/a:r)}else this.context.drawImage(t.texture.effect_sprites[t.sFrame].canvas,0,0,s,o,e,i,n,r);u===!0&&(this.context.globalAlpha=1),y.EDIT_MODE===!0&&(this.context.globalAlpha=1,this.context.globalCompositeOperation="source-over"),this.context.resetTransform()}function d(t,e,i,n,r,s,o){var a=this.camera.resolution;this.context.drawImage(t.shadow.texture.sprites[t.sFrame].canvas,0,0,s,o,e+t.shadow.position.x*t.scale*a<<0,i+t.shadow.position.y*t.scale*a+o/2*t.scale*a<<0,(n+t.shadow.scale.x*t.scale*a)/y.SHADOW_X<<0,(r+t.shadow.scale.y*t.scale*a)/y.SHADOW_Y<<0)}function p(t,e,i,n,r,s){this.context.font=n+"px AdvoCut",this.context.strokeStyle=s,this.context.lineWidth=r,this.context.strokeText(t,e,i),this.context.fillStyle="white",this.context.fillText(t,e,i)}Object.defineProperty(e,"__esModule",{value:!0}),e.render=r,e.clear=s,e.draw=o,e.renderMap=a,e.entityInSelectionRange=u,e.getAnimationFrame=l,e.updateEntitySpriteFrame=h,e.renderEntities=c,e.renderEntity=f,e.renderShadow=d,e.drawPixelText=p;var y=i(6),v=i(85),g=(n(v),i(133))},function(t,e){"use strict";function i(t,e,i,n,r,s,o,a,u){var l=s*o,h=s*o,c=e%l,f=i%h;for(t.beginPath();n>c;c+=l)t.moveTo(c-a,0),t.lineTo(c-a,r);for(;r>f;f+=h)t.moveTo(0,f+a),t.lineTo(n,f+a);t.strokeStyle=u,t.lineWidth=a,t.stroke(),t.closePath()}Object.defineProperty(e,"__esModule",{value:!0}),e.drawGrid=i},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(){var t="#313131";this.drawPixelText("WIDTH: "+this.width+" HEIGHT "+this.height,15,30,20,1.5,t),this.drawPixelText("DIMENSION: "+u.DIMENSION,15,60,20,1.5,t),this.drawPixelText("X: "+this.camera.x.toFixed(2)+" Y: "+this.camera.y.toFixed(2),15,90,20,1.5,t),this.drawPixelText("DELTA: "+1e3*this.delta+" ms",15,120,20,1.5,t),this.drawPixelText("SCALE: "+this.camera.resolution.toFixed(6),15,150,20,1.5,t),this.drawPixelText("ENTITIES: "+this.instance.currentMap.entities.length,15,180,20,1.5,t);var e=0,i=0,n=0,r=this.instance.currentMap.entities;for(n=r.length;n>e;++e)this.instance.camera.isInView(r[e].position.x,r[e].position.y,r[e].size.x,2*r[e].size.y+r[e].shadowY)&&++i;this.drawPixelText("ENTITIES IN VIEW: "+i,15,210,20,1.5,t),this.drawPixelText("TEXTURES: "+(0,o["default"])(a.TextureCache).length,15,240,20,1.5),null!==this.instance.localEntity&&this.drawPixelText("LOCAL X: "+this.instance.localEntity.x+" Y: "+this.instance.localEntity.y.toFixed(2)+" LOCAL Z: "+-this.instance.localEntity.z.toFixed(4),15,270,20,1.5,t),this.drawPixelText("COMMAND STACK: "+(this.instance.editor.commander.position+1)+" | "+this.instance.editor.commander.stack.length,15,300,20,1.5,t),this.drawPixelText("GOD MODE: "+(u.GOD_MODE===!0?"enabled":"disabled"),15,330,20,1.5,t),this.drawPixelText("FREE CAMERA: "+(u.FREE_CAMERA===!0?"enabled":"disabled"),15,360,20,1.5,t),this.drawPixelText("EDIT MODE: "+(u.EDIT_MODE===!0?"enabled":"disabled"),15,390,20,1.5,t),this.drawPixelText("C: JUMP",15,this.height-60,20,1.5,t),this.drawPixelText("X: RUN",90,this.height-60,20,1.5,t),this.drawPixelText("Z: ACTION",155,this.height-60,20,1.5,t),this.drawPixelText("CTRL+Z: UNDO",15,this.height-35,20,1.5,t),this.drawPixelText("CTRL+Y: REDO",140,this.height-35,20,1.5,t),this.drawPixelText("CTRL+C: COPY",265,this.height-35,20,1.5,t),this.drawPixelText("CTRL+V: PASTE",390,this.height-35,20,1.5,t),this.drawPixelText("CTRL+X: CUT",525,this.height-35,20,1.5,t),this.drawPixelText("F1: DEBUG MODE",15,this.height-10,20,1.5,t),this.drawPixelText("F2: EDIT MODE",155,this.height-10,20,1.5,t),this.drawPixelText("F3: FREE CAMERA",290,this.height-10,20,1.5,t),this.drawPixelText("F4: GOD MODE",450,this.height-10,20,1.5,t),this.drawPixelText("SPACE: PLAYER FOCUS",575,this.height-10,20,1.5,t),this.drawPixelText("WHEEL: ZOOM",770,this.height-10,20,1.5,t),this.drawPixelText("R-MOUSE: DRAG MAP",890,this.height-10,20,1.5,t),this.drawPixelText("DBLCLICK: FOCUS ENTITY",1065,this.height-10,20,1.5,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.renderDebugScene=r;var s=i(135),o=n(s),a=i(7),u=i(6)},function(t,e,i){t.exports={"default":i(136),__esModule:!0}},function(t,e,i){i(137),t.exports=i(19).Object.keys},function(t,e,i){var n=i(68);i(69)("keys",function(t){return function(e){return t(n(e))}})},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),o=r(s),a=i(2),u=r(a),l=i(7),h=i(139),c=n(h),f=function(){function t(e){(0,o["default"])(this,t),this.instance=e,this.shaderProgram=null,this.vshader=null,this.fshader=null,this.gl=e.gl,this.spritepos=null,this.posbuffer=null,this.ready=!1}return(0,u["default"])(t,[{key:"init",value:function(){var t=this.gl,e=this.instance.instance.currentMap.entities,i=e.length;this.spritepos=new Float32Array(12*i),this.spriteidx=new Float32Array(6*i),this.vshaderid=t.createShader(t.VERTEX_SHADER),this.fshaderid=t.createShader(t.FRAGMENT_SHADER),this.compileShader(0,this.vshaderid,c.spritevs),this.compileShader(1,this.fshaderid,c.spritefs),this.shaderProgram=t.createProgram(),t.attachShader(this.shaderProgram,this.vshaderid),t.attachShader(this.shaderProgram,this.fshaderid),t.linkProgram(this.shaderProgram),t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.disable(t.BLEND),this.posbuffer=t.createBuffer(),this.idxbuffer=t.createBuffer();for(var n=0;i>n;n++)this.spriteidx[6*n+0]=0,this.spriteidx[6*n+1]=1,this.spriteidx[6*n+2]=2,this.spriteidx[6*n+3]=1,this.spriteidx[6*n+4]=2,this.spriteidx[6*n+5]=3;this.setAttribute(this.shaderProgram,this.idxbuffer,"aIdx",6*i,1,this.spriteidx),this.ready=!0}},{key:"draw",value:function(){var t=this.gl,e=null,i=null,n=0,r=0,s=0,o=0,a=this.instance.instance.currentMap.entities,u=a.length,l=0,h=0,c=this.instance.camera,f=c.resolution,d=c.position.x,p=c.position.y;for(t.useProgram(this.shaderProgram),e=t.getUniformLocation(this.shaderProgram,"uScale"),t.uniform2f(e,this.instance.width,this.instance.height),e=t.getUniformLocation(this.shaderProgram,"uObjScale");u>l;++l){for(i=a[l],n=d+(i.position.x+i.xMargin)*f<<0,r=p+(i.position.y+i.yMargin+i.z)*f<<0,s=i.size.x*f<<0,o=i.size.y*f<<0,h=0;6>h;++h)this.spritepos[12*l+2*h]=n+s/2,this.spritepos[12*l+2*h+1]=r+o/2;t.uniform2f(e,s,o),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i.glTexture)}this.setAttribute(this.shaderProgram,this.posbuffer,"aObjCen",6,2,this.spritepos),this.setAttribute(this.shaderProgram,this.idxbuffer,"aIdx",6*u,1),t.drawArrays(t.TRIANGLES,0,6*u)}},{key:"bufferTexture",value:function(t){var e=this.gl,i=e.createTexture(),n=(0,l.canvasToImage)(t);return e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),i}},{key:"compileShader",value:function(t,e,i){var n=this.gl;if(n.shaderSource(e,i),n.compileShader(e),!n.getShaderParameter(e,n.COMPILE_STATUS))throw"shader "+t+" compile error: "+n.getShaderInfoLog(e)}},{key:"compileShaders",value:function(){var t=this.gl,e=this.instance.instance.currentMap.entities,i=e.length;this.vshader=t.createShader(t.VERTEX_SHADER),this.fshader=t.createShader(t.FRAGMENT_SHADER),this.compileShader(0,this.vshader,c.spritevs),this.compileShader(1,this.fshader,c.spritefs),this.shaderProgram=t.createProgram(),t.attachShader(this.shaderProgram,c.vshader),t.attachShader(this.shaderProgram,c.fshader),t.linkProgram(this.shaderProgram),this.posbuffer=t.createBuffer(),this.setAttribute(this.shaderProgram,this.idxbuffer,"aIdx",6*i,1,this.spriteidx)}},{key:"resize",value:function(t,e){this.gl.viewport(0,0,t,e)}},{key:"clear",value:function(){this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}},{key:"setAttribute",value:function(t,e,i,n,r,s){var o=this.gl,a=o.getAttribLocation(t,i);o.enableVertexAttribArray(a),o.bindBuffer(o.ARRAY_BUFFER,e),s&&o.bufferData(o.ARRAY_BUFFER,s,o.DYNAMIC_DRAW),o.vertexAttribPointer(a,r,o.FLOAT,!1,0,0)}}]),t}();e["default"]=f},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.spritevs="\n  precision lowp float;\n  uniform vec2 uScale;\n  uniform vec2 uObjScale;\n  attribute vec2 aObjCen;\n  attribute float aObjRot;\n  attribute float aIdx;\n  varying vec2 uv;\n  void main(void) {\n    if (aIdx == 0.0) {\n      uv = vec2(0.0,0.0);\n    } else if (aIdx == 1.0) {\n      uv = vec2(1.0,0.0);\n    } else if (aIdx == 2.0) {\n      uv = vec2(0.0,1.0);\n    } else {\n      uv = vec2(1.0,1.0);\n    }\n    vec2 pos = vec2(\n      aObjCen.x + sin(aObjRot)*uObjScale.y*(-0.5 + uv.y)\n      + cos(aObjRot)*uObjScale.x*(-0.5 + uv.x),\n      aObjCen.y + cos(aObjRot)*uObjScale.y*(-0.5 + uv.y)\n      - sin(aObjRot)*uObjScale.x*(-0.5 + uv.x)\n    );\n    gl_Position = vec4(\n      -1.0 + 2.0*pos.x/uScale.x,\n      1.0 - 2.0*pos.y/uScale.y,\n      0.0, 1.0\n    );\n  }\n",e.spritefs="\n  precision lowp float;\n  uniform sampler2D uSampler;\n  varying vec2 uv;\n  void main(void) {\n    gl_FragColor = texture2D(uSampler, uv);\n    if (gl_FragColor.a < 0.5) discard;\n  }\n"},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(92),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=i(141),c=n(h),f=i(142),d=n(f),p=function(){function t(e,i){(0,a["default"])(this,t),this.instance=i,this.events=e,this.KeyBoard=new c["default"],this.Mouse=new d["default"],this.registerKeys(),this.registerMouse(),this.registerGlobal()}return(0,l["default"])(t,[{key:"registerKeys",value:function(){if(void 0!==this.events.keys){var t=!0,e=!1,i=void 0;try{for(var n,r=(0,s["default"])(this.events.keys);!(t=(n=r.next()).done);t=!0){var o,a=n.value;this.KeyBoard.registerKey(a,(o=this.instance.engine.controller,a.fire).bind(o),a.leave instanceof Function?(o=this.instance.engine.controller,a.leave).bind(o):void 0)}}catch(u){e=!0,i=u}finally{try{!t&&r["return"]&&r["return"]()}finally{if(e)throw i}}}}},{key:"registerMouse",value:function(){if(void 0!==this.events.mouse){var t=!0,e=!1,i=void 0;try{for(var n,r=(0,s["default"])(this.events.mouse);!(t=(n=r.next()).done);t=!0){var o=n.value;this.Mouse.registerEvent(o,this.instance.engine.controller)}}catch(a){e=!0,i=a}finally{try{!t&&r["return"]&&r["return"]()}finally{if(e)throw i}}}}},{key:"registerGlobal",value:function(){if(void 0!==this.events.global){var t=!0,e=!1,i=void 0;try{for(var n,r=(0,s["default"])(this.events.global);!(t=(n=r.next()).done);t=!0){var o=n.value;this.registerGlobalEvent(o,this.instance.engine.controller)}}catch(a){e=!0,i=a}finally{try{!t&&r["return"]&&r["return"]()}finally{if(e)throw i}}}}},{key:"registerGlobalEvent",value:function(t){var e;window.addEventListener(t.name,(e=this.instance.engine.controller,t.fire).bind(e),!1)}}]),t}();e["default"]=p},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(92),s=n(r),o=i(135),a=n(o),u=i(1),l=n(u),h=i(2),c=n(h),f=i(7),d=function(){function t(e){return(0,l["default"])(this,t),this.ENTER=13,this.SPACE=32,this.BACKSPACE=8,this.TAB=9,this.SHIFT=16,this.CTRL=17,this.ALT=18,this.PAUSE=19,this.CAPSLOCK=20,this.ESCAPE=27,this.PAGEUP=33,this.PAGEDOWN=34,this.END=35,this.HOME=36,this["←"]=37,this["↑"]=38,this["→"]=39,this["↓"]=40,this.INSERT=45,this.DELETE=46,this[0]=48,this[1]=49,this[2]=50,this[3]=51,this[4]=52,this[5]=53,this[6]=54,this[7]=55,this[8]=56,this[9]=57,this.A=65,this.B=66,this.C=67,this.D=68,this.E=69,this.F=70,this.G=71,this.H=72,this.I=73,this.J=74,this.K=75,this.L=76,this.M=77,this.N=78,this.O=79,this.P=80,this.Q=81,this.R=82,this.S=83,this.T=84,this.U=85,this.V=86,this.W=87,this.X=88,this.Y=89,this.Z=90,this.SELECT=93,this.NUMPAD0=96,this.NUMPAD1=97,this.NUMPAD2=98,this.NUMPAD3=99,this.NUMPAD4=100,this.NUMPAD5=101,this.NUMPAD6=102,this.NUMPAD7=103,this.NUMPAD8=104,this.NUMPAD9=105,this.MULTIPLY=106,this.ADD=107,this.SUBTRACT=109,this.DECIMALPOINT=110,this.DIVIDE=111,this.F1=112,this.F2=113,this.F3=114,this.F4=115,this.F5=116,this.F6=117,this.F7=118,this.F8=119,this.F9=120,this.F10=121,this.F11=122,this.F12=123,this.NUMLOCK=144,this.SCROLLLOCK=145,this.SEMICOLON=186,this.EQUALSIGN=187,this.COMMA=188,this.DASH=189,this.PERIOD=190,this.FORWARDSLASH=191,this.GRAVEACCENT=192,this.OPENBRACKET=219,this.BACKSLASH=220,this.CLOSEBRACKET=221,this.SINGLEQUOTE=222,this.KEYS={},this.COMBOS={},this.hashes=[],this.hash=(0,f.uHash)(),this.rate=60,this.init(e),this}return(0,c["default"])(t,[{key:"init",value:function(t){if(t instanceof Object&&(0,a["default"])(t).length>0){this.rate=t.rate||60;for(var e in t)e.toUpperCase()===e&&"rate"!==e&&"hash"!==e&&this.registerKey(e,t[e])}this.loop(),this.fireKeys(),window.addEventListener("keydown",function(t){this.switchKey(this.hash,t.keyCode,1,t)}.bind(this)),window.addEventListener("keyup",function(t){this.switchKey(this.hash,t.keyCode,0,t)}.bind(this))}},{key:"loop",value:function(){var t=this;this.fireKeys(),setTimeout(function(){return t.loop()},this.rate)}},{key:"fireCombo",value:function(t,e,i){this.COMBOS[e].state=i,t.state=0;var n=!0,r=!1,o=void 0;try{for(var a,u=(0,s["default"])(t.combo);!(n=(a=u.next()).done);n=!0){var l=a.value;if(1!==this.COMBOS[l].state)return}}catch(h){r=!0,o=h}finally{try{!n&&u["return"]&&u["return"]()}finally{if(r)throw o}}t.state=1}},{key:"switchKey",value:function(t,e,i,n){var r=String(e);if(this.isComboKey(e)===!0){var s=this.COMBOS[e].parent;this.COMBOS[r].state=i,this.updateKey(s,i),this.fireCombo(s,e,i,n)}this.hash!==t||this.validKey(r)===!1||i>1||0>i||(this.updateKey(this.KEYS[r],i),n.preventDefault())}},{key:"updateKey",value:function(t,e){t.state=e,0===e&&(t.left=1),t.spam===!1&&0===e&&(t.fireable=!0)}},{key:"validKey",value:function(t){var e=String(t);return this.KEYS[e]instanceof Object&&this.KEYS[e].fire instanceof Function&&this.KEYS[e].state<=1&&this.KEYS[e].state>=0}},{key:"validCode",value:function(t){var e=t;if(-1===(t=this[e]||-1)||void 0!==this.KEYS[e])throw new Error(e+" is a invalid key!");return!0}},{key:"registerKeyCombo",value:function(t,e,i){var n=String(t.name),r=n.split("+"),o=[];this.COMBOS[n]={};var a=!0,u=!1,l=void 0;try{for(var h,c=(0,s["default"])(r);!(a=(h=c.next()).done);a=!0){var f=h.value;if(this.validCode(f)===!1)return;o.push(this[f]),this.COMBOS[this[f]]={parent:this.COMBOS[n],name:f,fire:e,leave:i,left:0,state:0,fireable:!0,spam:t.spam}}}catch(d){u=!0,l=d}finally{try{!a&&c["return"]&&c["return"]()}finally{if(u)throw l}}this.COMBOS[n].combo=o,this.COMBOS[n].fire=e,this.COMBOS[n].leave=i,this.COMBOS[n].left=0,this.COMBOS[n].state=0,this.COMBOS[n].fireable=!0,this.COMBOS[n].spam=t.spam}},{key:"registerKey",value:function(t,e,i){var n=String(t.name),r=n.split("+").length>1;return r===!0?void this.registerKeyCombo(t,e,i):void(this.validCode(n)!==!1&&(this.KEYS[this[n]]={name:t.name,fire:e,leave:i,left:0,state:0,fireable:!0,spam:t.spam}))}},{key:"fireKeys",value:function(){var t=null;for(t in this.KEYS)if(this.validKey(t)===!0)if(this.isComboKey(t)===!0){var e=this.COMBOS[t].parent;e.simultaneous!==!1&&0===e.state&&this.fireKey(this.hash,this.KEYS[t])}else this.fireKey(this.hash,this.KEYS[t]);for(t in this.COMBOS)void 0===this.COMBOS[t].parent&&this.fireKey(this.hash,this.COMBOS[t])}},{key:"isComboKey",value:function(t){return void 0!==this.COMBOS[t]&&this.COMBOS[t]instanceof Object==!0}},{key:"fireKey",value:function(t,e){1===e.state?e.fireable===!0&&(e.fire(),void 0!==e.spam&&(e.fireable=!1)):void 0!==e.leave&&0===e.state&&1===e.left&&(e.leave(),e.left=0)}},{key:"isKeyPressed",value:function(t){var e="string"==typeof t;return e===!0?void 0!==this[t]?void 0!==this.KEYS[this[t]]&&1===this.KEYS[this[t]].state:!1:void 0!==this.KEYS[t]&&1===this.KEYS[t].state}}]),t}();e["default"]=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(92),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=(i(7),function(){function t(){return(0,a["default"])(this,t),this}return(0,l["default"])(t,[{key:"registerEvent",value:function(t,e){var i=t.name.split("|"),n=!0,r=!1,o=void 0;try{for(var a,u=(0,s["default"])(i);!(n=(a=u.next()).done);n=!0){var l=a.value;"mousewheel"===l?window.addWheelListener(document.body,function(i){return t.fire.call(e,i)}):window.addEventListener(l,function(i){return t.fire.call(e,i)},!1)}}catch(h){r=!0,o=h}finally{try{!n&&u["return"]&&u["return"]()}finally{if(r)throw o}}}}]),t}());e["default"]=h},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(144),o=r(s),a=i(1),u=r(a),l=i(2),h=r(l),c=i(148),f=n(c),d=(i(6),i(7)),p=i(85),y=r(p),v=function(){function t(e,i){(0,u["default"])(this,t),this.instance=e,this.ws=null,this.open=!1,this.init(i)}return(0,h["default"])(t,[{key:"init",value:function(t){this.open=!0,this.ws=new window.WebSocket("ws://"+t),this.ws.binaryType="arraybuffer",this.ws.addEventListener("open",this.onOpen.bind(this)),this.ws.addEventListener("close",this.onClose.bind(this)),this.ws.addEventListener("error",this.onError.bind(this)),this.ws.addEventListener("message",this.onMessage.bind(this))}},{key:"onOpen",value:function(){console.log("Socket Open!"),this.sendUserData()}},{key:"onClose",value:function(t){console.log(t)}},{key:"onError",value:function(){console.log("Socket closed!")}},{key:"onMessage",value:function(t){this.handleMessage(new DataView(t.data))}},{key:"handleMessage",value:function(t){function e(){for(var e="",n=0;0!==(n=t.getUint16(i,!0));)i+=2,e+=String.fromCharCode(n);return i+=2,e}var i=0,n=t.getUint8(i++);if(0===n){var r=this.getString(t);console.log(r)}if(22===n){i+=4,i+=4;var r=JSON.parse(e()),s=this.instance.entities.Player,o=new s(r);o.instance=this.instance.engine,this.instance.engine.addEntity(o),o.isLocalPlayer===!0&&(this.instance.engine.localEntity=o,this.instance.engine.camera.focus(o,!1))}if(40===n){i+=4,i+=4;var r=JSON.parse(e());for(var a in r)this.instance.engine.addEntity(new this.instance.entities.Player(r[a]))}if(30===n){i+=4,i+=4;var r=JSON.parse(e()),o=this.instance.engine.getEntityByProperty(r.name,"name");o.jump()}if(31===n){i+=4,i+=4;var r=JSON.parse(e()),o=this.instance.engine.getEntityByProperty(r.name,"name");o.changeFacing(r.dir)}if(32===n){i+=4,i+=4;var r=JSON.parse(e()),o=this.instance.engine.getEntityByProperty(r.name,"name"),u=y["default"].getTilePosition(r.x,r.y,r.dir);d.Maps[o.map].isEntityCollidable(o,u.x,u.y)===!0;o.onlineMove(u.x,u.y,u.facing)}if(33===n){i+=4,i+=4;var r=JSON.parse(e()),o=this.instance.engine.getEntityByProperty(r.name,"name");o.velocity=r.velocity}if(34===n){i+=4,i+=4;var r=JSON.parse(e()),o=this.instance.engine.getEntityByProperty(r.name,"name");o.fadeOut(1,!0)}}},{key:"prepareData",value:function(t){return new DataView(new ArrayBuffer(t))}},{key:"send",value:function(t){this.ws.send(t.buffer)}},{key:"sendUserData",value:function(){if(this.open!==!1){var t=location.search.replace("?",""),e=this.prepareData(1+2*t.length);e.setUint8(0,0);for(var i=0;i<t.length;++i)e.setUint16(1+2*i,t.charCodeAt(i),!0);this.send(e)}}},{key:"stobuf",value:function(t){for(var e=0,i=t.length,n=new ArrayBuffer(i),r=new Uint8Array(n);i>e;++e)r[e]=t[e];return r.buffer}},{key:"sendData",value:function(t,e){var i=f[t];if(void 0!==i&&null!==i){var n=new(Function.prototype.bind.apply(i,[null].concat((0,o["default"])(e))));this.send(n)}}},{key:"getString",value:function(t){if((t.byteLength+1)%2!==1){for(var e="",i=64,n=1;n<t.byteLength&&i>=n;n+=2){var r=t.getUint16(n,!0);if(0==r)return;e+=String.fromCharCode(r)}return e}}}]),t}();e["default"]=v},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}e.__esModule=!0;var r=i(145),s=n(r);e["default"]=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return(0,s["default"])(t)}},function(t,e,i){t.exports={"default":i(146),__esModule:!0}},function(t,e,i){i(11),i(147),t.exports=i(19).Array.from},function(t,e,i){"use strict";var n=i(20),r=i(17),s=i(68),o=i(47),a=i(48),u=i(49),l=i(50);r(r.S+r.F*!i(61)(function(t){Array.from(t)}),"Array",{from:function(t){var e,i,r,h,c=s(t),f="function"==typeof this?this:Array,d=arguments,p=d.length,y=p>1?d[1]:void 0,v=void 0!==y,g=0,m=l(c);if(v&&(y=n(y,p>2?d[2]:void 0,2)),void 0==m||f==Array&&a(m))for(e=u(c.length),i=new f(e);e>g;g++)i[g]=v?y(c[g],g):c[g];else for(h=m.call(c),i=new f;!(r=h.next()).done;g++)i[g]=v?o(h,y,[r.value,g],!0):r.value;return i.length=g,i}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(149);Object.defineProperty(e,"Facing",{enumerable:!0,get:function(){return n.Facing}});var r=i(150);Object.defineProperty(e,"Jumping",{enumerable:!0,get:function(){return r.Jumping}});var s=i(151);Object.defineProperty(e,"Position",{enumerable:!0,get:function(){return s.Position}});var o=i(152);Object.defineProperty(e,"Velocity",{enumerable:!0,get:function(){return o.Velocity}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Facing=void 0;var r=i(1),s=n(r),o=i(2),a=n(o);e.Facing=function(){function t(e,i){return(0,s["default"])(this,t),this.id=e,this.dir=i,this.encode()}return(0,a["default"])(t,[{key:"encode",value:function(){var t=new ArrayBuffer(5),e=new DataView(t);return e.setUint8(0,31,!0),e.setUint16(1,this.id,!0),e.setUint16(3,this.dir,!0),e}}]),t}()},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Jumping=void 0;var r=i(1),s=n(r),o=i(2),a=n(o);e.Jumping=function(){function t(e){return(0,s["default"])(this,t),this.id=e,this.encode()}return(0,a["default"])(t,[{key:"encode",value:function(){var t=new ArrayBuffer(3),e=new DataView(t);return e.setUint8(0,30,!0),e.setUint16(1,this.id,!0),e}}]),t}()},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Position=void 0;var r=i(1),s=n(r),o=i(2),a=n(o);e.Position=function(){function t(e,i,n,r){return(0,s["default"])(this,t),this.id=e,this.dir=i,this.x=n,this.y=r,this.encode()}return(0,a["default"])(t,[{key:"encode",value:function(){var t=new ArrayBuffer(9),e=new DataView(t);return e.setUint8(0,32,!0),e.setUint16(1,this.id,!0),e.setUint16(3,this.dir,!0),e.setUint16(5,this.x,!0),e.setUint16(7,this.y,!0),e}}]),t}()},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Velocity=void 0;var r=i(1),s=n(r),o=i(2),a=n(o);e.Velocity=function(){function t(e,i){return(0,s["default"])(this,t),this.id=e,this.velocity=i,this.encode()}return(0,a["default"])(t,[{key:"encode",value:function(){var t=new ArrayBuffer(5),e=new DataView(t);return e.setUint8(0,33,!0),e.setUint16(1,this.id,!0),e.setUint16(3,this.velocity,!0),e}}]),t}()},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.keys=[{name:"SHIFT",fire:function(){},leave:function(){this.action("SHIFT")}},{name:"CTRL+Z",simultaneous:!1,fire:function(){this.action("CTRL+Z")}},{name:"CTRL+Y",simultaneous:!1,fire:function(){this.action("CTRL+Y")}},{name:"CTRL+C",spam:!1,simultaneous:!1,fire:function(){this.action("CTRL+C")}},{name:"CTRL+V",spam:!1,simultaneous:!1,fire:function(){this.action("CTRL+V")}},{name:"CTRL+X",spam:!1,simultaneous:!1,fire:function(){this.action("CTRL+X")}},{name:"DELETE",fire:function(){this.action("DELETE")}},{name:"F1",spam:!1,fire:function(){this.action("F1")}},{name:"F2",spam:!1,fire:function(){this.action("F2")}},{name:"F3",spam:!1,fire:function(){this.action("F3")}},{name:"F4",spam:!1,fire:function(){this.action("F4")}},{name:"Y",fire:function(){}},{name:"G",fire:function(){}},{name:"V",fire:function(){}},{name:"CTRL",fire:function(){}},{name:"ESCAPE",spam:!1,fire:function(){this.action("ESCAPE")}},{name:"B",spam:!1,fire:function(){this.action("B")}},{name:"Z",spam:!1,fire:function(){this.action("Z")}},{name:"X",spam:!1,fire:function(){this.action("X_FIRE")},leave:function(){this.action("X_LEAVE")}},{name:"C",spam:!1,fire:function(){this.action("C")}},{name:"←",fire:function(){this.action("←")}},{name:"→",fire:function(){this.action("→")}},{name:"↑",fire:function(){this.action("↑")}},{name:"↓",fire:function(){this.action("↓")}},{name:"SPACE",fire:function(){this.action("SPACE")}}],e.mouse=[{name:"dblclick",fire:function(t){this.action("DBLCLICK",[t])}},{name:"mousedown|touchstart",fire:function(t){this.action("LEFTCLICK",[t])}},{name:"contextmenu",fire:function(t){this.action("RIGHTCLICK",[t])}},{name:"mouseup|touchend",fire:function(t){this.action("MOUSEUP",[t])}},{name:"mousemove|touchmove",fire:function(t){this.action("MOUSEMOVE",[t])}},{name:"mousewheel",fire:function(t){this.action("MOUSEWHEEL",[t])}}],e.global=[{name:"resize",fire:function(){this.action("RESIZE")}}]},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(155);Object.defineProperty(e,"Player",{enumerable:!0,get:function(){return n.Player}});var r=i(160);Object.defineProperty(e,"Monster",{enumerable:!0,get:function(){return r.Monster}})},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;var s=i(65),o=r(s),a=i(1),u=r(a),l=i(2),h=r(l),c=i(70),f=r(c),d=i(79),p=r(d),y=i(85),v=r(y),g=i(6),m=i(7),E=i(96),x=r(E),_=i(156),S=n(_),w=i(157),M=n(w),b=i(158),T=n(b),O=i(159),I=n(O),N=i(168),P=n(N),A=e.Player=function(t){function e(t){(0,u["default"])(this,e);var i=(0,f["default"])(this,(0,o["default"])(e).call(this,t));i.instance=null,i.gravity=g.GRAVITY,i.facing=void 0!==t.facing?t.facing:0,i.idle=0,i.STATES.WALKING=!1,i.STATES.RUNNING=!1,i.STATES.BUMPING=!1,i.STATES.WALKING=!1,i.STATES.FACING=!1,i.shadowX=void 0===t.shadowX?0:t.shadowX,i.shadowY=void 0===t.shadowY?-1.75:t.shadowY,i.isLocalPlayer=!1,i.isNPC=!1,i.isNetworkPlayer=!1,i.frames=[0,1,0,2,3,4],i.frameReset=[0,2,2,0],i.lastFacing=0,i.stepCount=0,i.faceCount=0,i.latency=.5,i.map=t.map,i.soundSteps=2*g.DIMENSION,i.xMargin=-(g.DIMENSION/2),i.yMargin=-g.DIMENSION,void 0!==t.x&&void 0!==t.y&&(i.x=t.x,i.y=t.y);var n=i.getLastPosition();return i.last.x=i.x+n.x,i.last.y=i.y+n.y,i.init(t),i}return(0,p["default"])(e,t),(0,h["default"])(e,[{key:"getLastPosition",value:function(){var t=0,e=0;return this.facing===g.LEFT||this.facing===g.RIGHT?t=this.facing===g.LEFT?g.DIMENSION:-g.DIMENSION:e=this.facing===g.DOWN?-g.DIMENSION:g.DIMENSION,{x:t,y:e}}},{key:"init",value:function(t){this.setPlayerType(t)}},{key:"setPlayerType",value:function(t){t.isLocalPlayer===!0?(this.isLocalPlayer=!0,this.isNPC=!1,this.isNetworkPlayer=!1):t.isNPC===!0?(this.isLocalPlayer=!1,this.isNPC=!0,this.isNetworkPlayer=!1):t.isNetworkPlayer===!0?(this.isLocalPlayer=!1,this.isNPC=!1,this.isNetworkPlayer=!0):(this.isLocalPlayer=!1,this.isNPC=!0,this.isNetworkPlayer=!1)}},{key:"getFrameIndex",value:function(){return this.STATES.RUNNING===!0?2:0}},{key:"resetFrame",value:function(){this.frame=this.frameReset[this.frame]+this.getFrameIndex()}},{key:"refreshState",value:function(){this.STATES.RUNNING=.5===this.velocity?!1:this.velocity>=1&&this.STATES.WALKING===!0,this.STATES.JUMPING=0!==this.z}},{key:"action",value:function(){var t=v["default"].getTilePosition(this.x<<0,this.y<<0,this.facing);m.Maps[this.map].actionTrigger(t,this)}},{key:"faceEntity",value:function(t){var e=this.oppositFacing(t.facing);this.facing!==e&&this.changeFacing(e)}},{key:"animate",value:function(){if(this.STATES.JUMPING===!0&&this.jumping(),!(this.animations.length<=0)){this.animationIndex=0;for(var t=0,e=null,i=!1,n=!1;t<this.animations.length;++t)e=this.animations[this.animationIndex],"walk"===e.type&&i===!0||"bump"===e.type&&n===!0||(this[e.type](e),"walk"===e.type&&(i=!0),"bump"===e.type&&(n=!0),this.animationIndex++)}}},{key:"velocity",get:function(){return this.latency},set:function(t){this.latency=t/2,this.isLocalPlayer===!0&&g.OFFLINE_MODE===!1&&this.instance.engine.connection.sendData("Velocity",[this.id,t]),this.leader&&(this.leader.velocity=t),this.refreshState()}},{key:"moving",get:function(){return this.STATES.WALKING===!0||this.STATES.RUNNING===!0},set:function(t){this.STATES.WALKING=t,this.STATES.RUNNING=t}}]),e}(x["default"]);(0,m.inherit)(A,S),(0,m.inherit)(A,M),(0,m.inherit)(A,T),(0,m.inherit)(A,I),(0,m.inherit)(A,P)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(){this.jumpable!==!1&&(this.refreshState(),this.STATES.JUMPING!==!0&&this.STATES.LOCK!==!0&&(this.STATES.JUMPING=!0,null!==this.onJump&&l.Maps[this.map].triggerEvent(this,this,"onJump"),this.jumping(),this.isLocalPlayer===!0&&u.OFFLINE_MODE===!1&&this.instance.engine.connection.sendData("Jumping",[this.id]),this.idleTime=0))}function s(){var t=this;if(this.frame=3,0===this.z&&this.playStateSound(),this.z+=this.gravity,this.refreshState(),this.z<0)this.gravity+=.1,this.shadow.position.set(-(this.z/2),this.shadowY-this.z),
this.shadow.scale.set(this.z,this.z);else if(this.gravity=u.GRAVITY,this.z=0,this.resetFrame(),this.refreshState(),this.shadow.position.set(this.shadowX,this.shadowY),this.shadow.scale.set(0,0),this.isLocalPlayer===!0){var e=0,i=!0,n=!1,r=void 0;try{for(var s,o=function(){var i=s.value;return++e,i.id===t.id?"continue":void setTimeout(function(){i.jump()},25*e)},l=(0,a["default"])(game.engine.currentMap.entities);!(i=(s=l.next()).done);i=!0){o()}}catch(h){n=!0,r=h}finally{try{!i&&l["return"]&&l["return"]()}finally{if(n)throw r}}}}Object.defineProperty(e,"__esModule",{value:!0}),e.jump=r,e.jumping=s;var o=i(92),a=n(o),u=i(6),l=i(7)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(this.moving!==!0){var i=0,n=0,r=v["default"].roundTo(this.x,d.DIMENSION),s=v["default"].roundTo(this.y,d.DIMENSION);t=v["default"].roundTo(t,d.DIMENSION),e=v["default"].roundTo(e,d.DIMENSION);var o=0,a=0,u=0,l=p.Maps[this.map].path.getShortestPath(r,s,t,e);if(!(void 0===l||null===l||l.length<=0))for(n=l.length;n>i;++i)o=l[i].x*d.DIMENSION,a=l[i].y*d.DIMENSION,o!==r?u=r>o?d.LEFT:d.RIGHT:a!==s&&(u=s>a?d.UP:d.DOWN),this.animations.push({type:"walk",facing:u,obstacle:!1,x:o,y:a,oX:this.x,oY:this.y,isPath:!0}),r=o,s=a}}function s(t,e){if(this.moving!==!0){if(this.facing!==t)this.STATES.BUMPING===!0&&this.skipBump();else if(this.STATES.BUMPING===!0)return;this.STATES.BUMPING!==!0&&(this.moveCB=e||null,this.startMoving(this.x,this.y,t),this.refreshState())}}function o(t,e,i){t=v["default"].roundTo(t,d.DIMENSION),e=v["default"].roundTo(e,d.DIMENSION),i<<=0;var n=0===p.Maps[this.map].collisionLayer.data[e/d.DIMENSION][t/d.DIMENSION]||p.Maps[this.map].isEntityCollidable(this,t,e)===!0;this.animations.push({type:"walk",facing:i,obstacle:n,x:t,y:e,oX:this.x,oY:this.y}),this.idleTime=0}function a(){this.stepCount=0,"bump"===this.animations[this.animationIndex-1].type&&this.animations.splice(this.animationIndex-1,1),this.moving=!1,this.STATES.BUMPING=!1}function u(){var t=Math.ceil(Math.ceil(d.DIMENSION/(2*this.velocity))/2);this.stepCount===t&&(this.frame=(this.frame+1+this.getFrameIndex())%4)}function l(){this.stepCount<=0&&this.playStateSound(),this.stepCount+=.5,this.STATES.JUMPING===!1&&this.halfStep(),this.stepCount>=2*d.DIMENSION&&(this.STATES.JUMPING===!1&&(this.halfStep(),this.resetFrame()),this.stepCount=0,this.stopAnimation(),this.STATES.BUMPING=!1,this.refreshState())}function h(t,e,i){if(this.facing!==i)return this.changeFacing(i),void(this.moveCB&&this.moveCB());var n=v["default"].getTilePosition(t,e,i),r=p.Maps[this.map].isObstacle(this,i);this.isLocalPlayer===!0&&d.GOD_MODE===!0&&(r=!1),this.isLocalPlayer===!0&&d.OFFLINE_MODE===!1&&this.instance.engine.connection.sendData("Position",[this.id,i,t,e]),r===!0?(this.animations.push({type:"bump",x:t,y:e}),this.STATES.BUMPING=!0):(this.animations.push({type:"walk",facing:i,obstacle:r,x:n.x,y:n.y,oX:t,oY:e}),this.moving=!0),this.idleTime=0}function c(t){var e=-1;this.x=t.x,this.y=t.y+d.Y_DEPTH_HACK,this.last.x=t.oX,this.last.y=t.oY,this.moving=!1,this.stepCount=0,setTimeout(function(){this.moving===!1&&this.STATES.BUMPING===!1&&this.STATES.JUMPING===!1&&this.resetFrame()}.bind(this),100),this.stopAnimation(),this.refreshState(),this.isLocalPlayer===!0?(this.instance.input.KeyBoard.isKeyPressed(this.facingToKey(d.LEFT))===!0?e=d.LEFT:this.instance.input.KeyBoard.isKeyPressed(this.facingToKey(d.UP))===!0?e=d.UP:this.instance.input.KeyBoard.isKeyPressed(this.facingToKey(d.RIGHT))===!0?e=d.RIGHT:this.instance.input.KeyBoard.isKeyPressed(this.facingToKey(d.DOWN))===!0?e=d.DOWN:this.soundSteps=d.DIMENSION,e>=0&&this.move(e)):this.soundSteps=d.DIMENSION,null!==this.leader&&this.follow(this.last.x,this.last.y,!1),this.moveCB&&this.moveCB()}function f(t){this.facing!==t.facing&&(this.changeFacing(t.facing),this.moveCB&&this.moveCB()),this.stepCount<=0&&(null!==this.leader&&this.follow(this.x,this.y,!1),this.STATES.JUMPING===!1&&this.resetFrame(),t.obstacle===!1),this.playStateSound(),t.obstacle===!1&&(this.STATES.JUMPING===!1&&this.halfStep(),this.x>t.x?this.x-=this.velocity:this.x<t.x?this.x+=this.velocity:this.y>t.y?this.y-=this.velocity:this.y<t.y&&(this.y+=this.velocity),this.stepCount+=this.velocity),this.stepCount>=d.DIMENSION&&(this.lastFacing=this.facing,this.stopMoving(t)),this.soundSteps+=this.velocity}Object.defineProperty(e,"__esModule",{value:!0}),e.walkTo=r,e.move=s,e.onlineMove=o,e.skipBump=a,e.halfStep=u,e.bump=l,e.startMoving=h,e.stopMoving=c,e.walk=f;var d=i(6),p=i(7),y=i(85),v=n(y)},function(t,e,i){"use strict";function n(t){this.STATES.LOCK!==!0&&this.moving!==!0&&(this.idleTime=0,this.moving===!1&&this.STATES.BUMPING===!1&&(this.lastFacing=this.facing,this.facing=t,this.isLocalPlayer===!0&&r.OFFLINE_MODE===!1&&this.instance.engine.connection.sendData("Facing",[this.id,this.facing]),this.frame=(this.frame+3+this.getFrameIndex())%4),setTimeout(function(){this.moving===!1&&this.STATES.BUMPING===!1&&this.STATES.JUMPING===!1&&this.resetFrame()}.bind(this),30))}Object.defineProperty(e,"__esModule",{value:!0}),e.changeFacing=n;var r=i(6)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(){if(s.BGS===!0){var t=this.isLocalPlayer===!0?s.VOLUME.NETWORK_PLAYER:s.VOLUME.LOCAL_PLAYER,e=o.Maps[this.map].distance(this,game.engine.camera);Math.abs(e.x)+Math.abs(e.y)>=1&&(e.x*=4,e.y*=4),this.STATES.JUMPING===!0&&0===this.z&&u["default"].playSound("jump",t,e.x,e.y),this.STATES.BUMPING===!0?u["default"].playSound("bump",t,e.x,e.y):this.moving===!0&&this.soundSteps>=2*s.DIMENSION&&(this.soundSteps=0,this.STATES.RUNNING===!0?u["default"].playSound("run_step",t,e.x,e.y):u["default"].playSound("ground_step",t,e.x,e.y))}}Object.defineProperty(e,"__esModule",{value:!0}),e.playStateSound=r;var s=i(6),o=i(7),a=i(90),u=n(a)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Monster=void 0;var r=i(65),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=i(70),c=n(h),f=i(79),d=n(f),p=i(96),y=n(p);e.Monster=function(t){function e(t){(0,a["default"])(this,e);var i=(0,c["default"])(this,(0,s["default"])(e).call(this,t));return i.init(t),i}return(0,d["default"])(e,t),(0,l["default"])(e,[{key:"init",value:function(){console.log(this)}}]),e}(y["default"])},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(162);Object.defineProperty(e,"Pause",{enumerable:!0,get:function(){return n.Pause}})},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Pause=void 0;var s=i(65),o=r(s),a=i(1),u=r(a),l=i(2),h=r(l),c=i(70),f=r(c),d=i(79),p=r(d),y=(i(6),i(163)),v=r(y),g=i(164),m=n(g),E=i(140);r(E),e.Pause=function(t){function e(t){(0,u["default"])(this,e);var i=(0,f["default"])(this,(0,o["default"])(e).call(this,{}));i.instance=t,i.active=!1,i.backgroundColor="#1f1f1f",i.color="#fff",i.selectedItem=null;return i.x=i.y=0,i.width=window.innerWidth,i.height=window.innerHeight,i.children.push(new m.Label({zIndex:2,text:"Game Paused"}),new m.Label({zIndex:2,text:"Editor"}),new m.Label({zIndex:2,text:"Exit"})),i.children.push(new m.Background({})),i.selectedItem=i.children[1],i.hide(),i}return(0,p["default"])(e,t),(0,h["default"])(e,[{key:"render",value:function(){}},{key:"navigate",value:function(t){var e=this.getChildrenIndexById(this.selectedItem.id),i=this.children.length;e+t>=i?this.selectedItem=this.children[2]:1>=e+t?this.selectedItem=this.children[i-1]:this.selectedItem=this.children[e+t],this.refresh()}},{key:"updatePositions",value:function(){var t=null,e=this.width/2,i=this.height/2,n=0,r=0;for(var s in this.children)t=this.children[s],t.id!==this.id&&t instanceof m.Label&&(t.id===this.selectedItem.id?t.opacity=1:t.opacity=.25,n=t.drawContext.measureText(t.text).width,r=t.fontSize<<0,t.x=e-n,t.y=i-r,i+=2*t.fontSize)}},{key:"refresh",value:function(){this.hide(),this.show()}},{key:"show",value:function(){this.active=!0,this.instance.activeScene=!0,this.drawContext.canvas.style.display="block",this.updatePositions(),this.render(),this.draw()}},{key:"hide",value:function(){this.active=!1,this.instance.activeScene=!1,this.drawContext.canvas.style.display="none",this.drawContext.canvas.width=this.width}}]),e}(v["default"])},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(65),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=i(70),c=n(h),f=i(79),d=n(f),p=i(98),y=n(p),v=i(7),g=function(t){function e(t){(0,a["default"])(this,e);var i=(0,c["default"])(this,(0,s["default"])(e).call(this,null));return i.x=Number(t.x)||0,i.y=Number(t.y)||0,i.width=Number(t.width)||250,i.height=Number(t.height)||75,i.scale=1,i.opacity=t.opacity||1,i.zIndex=t.zIndex||0,i.children=[],i.node=document.querySelector("#ui"),i.drawContext=i.node.getContext("2d"),i.buffer=(0,v.createCanvasBuffer)(i.width,i.height),Object.defineProperty(i,"resolution",{get:function(){return this.scale},set:function(t){this.scale=t,this.render()}}),i.children.push(i),i.render(),i}return(0,d["default"])(e,t),(0,l["default"])(e,[{key:"getChildrenIndexById",value:function(t){var e=0,i=0;for(i=this.children.length;i>e;++e)if(this.children[e].id===t)return e;return-1}},{key:"depthSort",value:function(t){for(var e=0,i=0,n=null,r=t.length;r>e;++e){for(i=e,n=t[i];i>0&&t[i-1].zIndex>n.zIndex;--i)t[i]=t[i-1];t[i]=n}}},{key:"render",value:function(){}},{key:"sort",value:function(){this.depthSort(this.children)}},{key:"draw",value:function(){var t=0,e=0;for(e=this.children.length,this.sort();e>t;++t)this.children[t].render(),this.children[t].id!==this.id&&this.children[t].draw()}}]),e}(y["default"]);e["default"]=g},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(165);Object.defineProperty(e,"Label",{enumerable:!0,get:function(){return n.Label}});var r=i(166);Object.defineProperty(e,"Button",{enumerable:!0,get:function(){return r.Button}});var s=i(167);Object.defineProperty(e,"Background",{enumerable:!0,get:function(){return s.Background}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Label=void 0;var r=i(65),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=i(70),c=n(h),f=i(79),d=n(f),p=i(163),y=n(p);e.Label=function(t){function e(t){(0,a["default"])(this,e);var i=(0,c["default"])(this,(0,s["default"])(e).call(this,t));return i.backgroundColor=t.backgroundColor,i.color=t.color||"#fff",i.zIndex=Number(t.zIndex)||0,i.text=t.text||"undefined",i.fontSize=25,i}return(0,d["default"])(e,t),(0,l["default"])(e,[{key:"render",value:function(){this.drawContext.globalAlpha=this.opacity,this.drawContext.font=this.fontSize+"px AdvoCut",this.drawContext.strokeStyle="white",this.drawContext.lineWidth=1,this.drawContext.fillStyle="white",this.drawContext.fillText(this.text,this.x,this.y),this.drawContext.globalAlpha=1}}]),e}(y["default"])},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Button=void 0;var r=i(65),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=i(70),c=n(h),f=i(79),d=n(f),p=i(163),y=n(p);e.Button=function(t){function e(t){(0,a["default"])(this,e);var i=(0,c["default"])(this,(0,s["default"])(e).call(this,t));return i.backgroundColor=t.backgroundColor,i.color=t.color||"#fff",i.zIndex=Number(t.zIndex)||0,i.width=t.width||250,i.height=t.height||75,i.render(),i}return(0,d["default"])(e,t),(0,l["default"])(e,[{key:"updatePosition",value:function(){this.x=window.innerWidth/2,this.y=window.innerHeight/2,this.x-=this.width/2,this.y-=this.height/2}},{key:"render",value:function(){this.updatePosition();var t=this.buffer.canvas.width=this.width,e=this.buffer.canvas.height=this.height;this.buffer.fillStyle=this.backgroundColor,this.buffer.fillRect(0,0,this.width,this.height),this.drawContext.drawImage(this.buffer.canvas,0,0,t,e,this.x,this.y,t,e)}}]),e}(y["default"])},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Background=void 0;var r=i(65),s=n(r),o=i(1),a=n(o),u=i(2),l=n(u),h=i(70),c=n(h),f=i(79),d=n(f),p=i(163),y=n(p);e.Background=function(t){function e(t){(0,a["default"])(this,e);var i=(0,c["default"])(this,(0,s["default"])(e).call(this,t));return i.backgroundColor=t.color||"#1f1f1f",i.color=t.color||"#fff",i.x=i.y=0,i.zIndex=Number(t.zIndex)||0,i.render(),i}return(0,d["default"])(e,t),(0,l["default"])(e,[{key:"render",value:function(){var t=this.buffer.canvas.width=this.width=window.innerWidth,e=this.buffer.canvas.height=this.height=window.innerHeight;this.buffer.globalAlpha=this.opacity,this.buffer.fillStyle=this.backgroundColor,this.buffer.fillRect(this.x,this.y,this.width,this.height),this.drawContext.drawImage(this.buffer.canvas,0,0,t,e,0,0,t,e)}}]),e}(y["default"])},function(t,e,i){"use strict";function n(t,e,i){var n=this.leader;i===!1&&n.x<<0===this.followTarget.x<<0&&n.y<<0===this.followTarget.y<<0&&(n.walkTo(t<<0,e<<0),this.followTarget.x=t<<0,this.followTarget.y=e<<0)}Object.defineProperty(e,"__esModule",{value:!0}),e.follow=n;i(6)}]);